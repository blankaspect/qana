<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html
   PUBLIC "-//W3C//DTD XHTML 1.1//EN"
   "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html
   xmlns="http://www.w3.org/1999/xhtml"
   xml:lang="en">

  <head>
    <meta
       http-equiv="content-type"
       content="application/xhtml+xml;charset=UTF-8"/>
    <meta
       content="initial-scale=1"
       name="viewport"/>
    <title>Qana : manual</title>
    <link
       href="style/blankaspect-common.css"
       rel="stylesheet"
       type="text/css"/>
    <link
       href="style/blankaspect-manual.css"
       rel="stylesheet"
       type="text/css"/>
    <link
       href="style/qana-manual.css"
       rel="stylesheet"
       type="text/css"/>
    <link
       href="images/icon-48x48.png"
       rel="icon"/>
    <script
       src="scripts/Toc.js"
       type="text/javascript">
    </script>
    <script
       src="scripts/init.js"
       type="text/javascript">
    </script>
  </head>

  <body>

    <!-- Title -->

    <div id="title">
      <div>
        <img alt="Icon" src="images/icon-48x48.png"/>
      </div>
      <div>
        Qana : manual
      </div>
    </div>

    <!--=====================================================================================-->

    <!-- Table of contents -->

    <div class="section">
      <h2 id="toc">Table of contents</h2>
      <div id="tocRoot">
        <div class="wrap" id="tocPlaceholder">
          You must have JavaScript enabled in your browser to generate the table of contents.
        </div>
      </div>
    </div>

    <!--=====================================================================================-->

    <!-- Introduction -->

    <div class="section">
      <h2 id="section1">1&nbsp; Introduction</h2>
      <p class="tocLink">
        [ <a href="#toc">Table of contents</a> ]
      </p>

      <p class="wrap">
        Qana is a Java application that encrypts files, text and archives (hierarchically
        structured sets of files) with a 256-bit symmetric-key cipher based on established
        cryptographic algorithms: the <a class="external"
        href="https://en.wikipedia.org/wiki/Scrypt">scrypt</a> password-based key-derivation
        function and the <a class="external"
        href="https://en.wikipedia.org/wiki/Fortuna_%28PRNG%29">Fortuna</a> cryptographically
        secure pseudo-random number generator, for which there is a choice of either <a
        class="external"
        href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES-256</a> or <a
        class="external" href="https://en.wikipedia.org/wiki/Salsa20">Salsa20</a> as the
        underlying cipher.
      </p>

      <h3 id="section1-1">1.1&nbsp; Features and functions</h3>

      <p class="wrap">
        Qana has the following features:
      </p>
      <ul class="list">
        <li class="spaced wrap">
          It performs symmetric-key encryption with a stream cipher whose 256-bit key is derived
          from a passphrase.  (A <i>symmetric key</i> means that the same key is used for
          encryption and decryption.)
        </li>
        <li class="spaced wrap">
          It maintains a database of named encryption keys, each of which is associated with a
          passphrase.  A <a class="external"
          href="https://en.wikipedia.org/wiki/Cryptographic_hash_function">cryptographic hash
          value</a> of a key&apos;s passphrase is stored in the database, allowing the
          passphrase to be verified while making recovery of the passphrase infeasible.  The
          strength of the hash value is configurable.
        </li>
        <li class="spaced">
          <div class="wrap">
            It uses well-regarded cryptographic algorithms:
          </div>
          <div>
            <ul class="list">
              <li class="spaced wrap">
                The stream cipher that it uses for encryption and decryption is generated by a
                <a class="external"
                href="https://en.wikipedia.org/wiki/Fortuna_%28PRNG%29">Fortuna</a>
                cryptographically secure pseudo-random number generator (PRNG) from either an <a
                class="external"
                href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES-256</a>
                block cipher running in counter mode or a <a class="external"
                href="https://en.wikipedia.org/wiki/Salsa20">Salsa20</a> cipher.
              </li>
              <li class="spaced wrap">
                The <a class="external" href="https://en.wikipedia.org/wiki/Scrypt">scrypt</a>
                key-derivation function is used to derive an encryption key for the stream
                cipher from a passphrase and to generate the hash values that are stored in the
                key database for verifying passphrases.  The key-derivation function has
                configurable parameters that provide a trade-off between speed and key strength.
              </li>
            </ul>
          </div>
        </li>
        <li class="spaced wrap">
          It has an easy-to-use graphical interface, including a straightforward key-management
          dialog.
        </li>
        <li class="spaced wrap">
          The <a class="external"
          href="https://en.wikipedia.org/wiki/Entropy_%28information_theory%29">entropy</a>
          sources of the Fortuna <abbr title="Pseudo-random number generator">PRNG</abbr> can be
          configured and their metrics observed to check that the generator is being supplied
          with entropy of a sufficient quality.
        </li>
      </ul>

      <p class="wrap">
        Qana can perform the following functions:
      </p>
      <ul class="list">
        <li class="spaced wrap">
          Individual files can be encrypted.
        </li>
        <li class="spaced wrap">
          Text can be edited and encrypted.  The encrypted text can be optionally wrapped in <a
          class="external" href="https://en.wikipedia.org/wiki/XML">XML</a>.
        </li>
        <li class="spaced wrap">
          A hierarchical set of files (ie, files in a directory structure) can be encrypted as
          an archive, which is stored as a set of encrypted files with generic names within the
          same directory, along with an encrypted file of metadata.  Selected sets of files can
          be extracted or deleted from the archive, and new files added to it.
        </li>
        <li class="spaced wrap">
          A single file can be split into several parts whose lengths are randomly selected from
          a specified range.  The parts are stored as a set of encrypted files with generic
          names.  The original file can be recovered if all its parts can be found in the same
          directory.
        </li>
        <li class="spaced wrap">
          Files or text can be encrypted and concealed within an image file.  The image may be
          chosen by the user or generated by the application.
        </li>
        <li class="spaced wrap">
          A file, text or an image can be generated with the same form as an encrypted output of
          Qana but whose apparently encrypted content is really random garbage.
        </li>
      </ul>

      <h3 id="section1-2">1.2&nbsp; Licence</h3>

      <p class="wrap">
        Qana is made available under two licences:
      </p>
      <ul class="list">
        <li class="spaced wrap">
          The contents of the <code>uk.blankaspect.qana</code> package (including resources) may
          be used under the terms of version 3 of the <a class="external"
          href="https://www.gnu.org/licenses/gpl-3.0.html">GNU General Public License</a>.
        </li>
        <li class="spaced wrap">
          All other contents of the GitHub <a
          href="https://github.com/blankaspect/qana">blankaspect/qana</a> repository may be used
          under the terms of the <a class="external" href="https://mit-license.org/">MIT
          License</a>.
        </li>
      </ul>
      
      <h3 id="section1-3">1.3&nbsp; A glossary of basic cryptographic terms</h3>

      <p class="wrap">
        Like all fields of study, <a class="external"
        href="https://en.wikipedia.org/wiki/Cryptography">cryptography</a> has its own jargon,
        which, when it is employed carefully, provides a concise and unambiguous way of
        referring to what are often complex concepts.  Several specialist terms are used in this
        document and in the Qana application itself; this section provides brief definitions of
        the some of the more basic ones.
      </p>
      <p class="wrap">
        The more advanced terms are explained by means of external links, mostly to articles in
        <a class="external" href="https://en.wikipedia.org/">Wikipedia</a>.  (If you are
        unfamiliar with cryptography, Wikipedia has many informative articles on the subject,
        and the present author thanks all the people that have contributed to them.)
      </p>
      <p class="wrap">
        Some of the terms below are compounds of the word <i>text</i>.  In cryptography,
        <i>text</i> is commonly used to refer to data of any kind.  It originated in a time when
        most of what was encrypted was text.
      </p>
      <dl class="terminology">
        <dt id="defEncryption">encryption</dt>
        <dd class="wrap">
          <i>Encryption</i> is the reversible process of transforming some data into an
          unintelligible form.  The reverse process is called <i>decryption</i>.
        </dd>

        <dt id="defCipher">cipher</dt>
        <dd class="wrap">
          A <i>cipher</i> is a pair of algorithms for performing the encryption and decryption
          of data.
        </dd>

        <dt id="defPlaintext">plaintext</dt>
        <dd class="wrap">
          <i>Plaintext</i> is unencrypted data that is an input of an encryption operation or an
          output of a decryption operation.
        </dd>

        <dt id="defCleartext">cleartext</dt>
        <dd class="wrap">
          <i>Cleartext</i> is unencrypted data that is not the input or output of a cipher.  The
          adverbial phrase &quot;in the clear&quot; means &quot;as cleartext&quot;; eg, <i>The
          message was transmitted in the clear.</i>
        </dd>

        <dt id="defCiphertext">ciphertext</dt>
        <dd class="wrap">
          <i>Ciphertext</i> is encrypted data.
        </dd>

        <dt id="defKey">key</dt>
        <dd class="wrap">
          A <i>key</i> is piece of information that, as an input to a <a
          href="#defCipher">cipher</a>, determines the transformation between <a
          href="#defPlaintext">plaintext</a> and <a href="#defCiphertext">ciphertext</a>.  The
          cipher used by Qana has a <i>symmetric key</i>; that is, the same key is used for
          encryption and decryption.  Because of this, the security of the cipher depends on
          keeping the key secret from an adversary.
        </dd>

        <dt id="defPassphrase">passphrase</dt>
        <dd class="wrap">
          A <i>passphrase</i> is a string of characters that is transformed into a <a
          href="#defKey">key</a> of a cipher.  (It is synonymous with <i>password</i>, though it
          has the implication that it is longer than a password and may contain multiple words.)
          In general, the longer a passphrase, the more security it offers.  A passphrase in
          Qana may contain any character from the <a class="external"
          href="https://en.wikipedia.org/wiki/Unicode_plane#Basic_Multilingual_Plane">Unicode
          Basic Multilingual Plane</a> except control characters or surrogates.
        </dd>
      </dl>

      <h3 id="section1-4">1.4&nbsp; Security considerations</h3>

      <p class="wrap">
        [ <small><i>I am breaking with convention by writing this part of the manual in the
        first person because I thought it would sound awkward if it were written in the third
        person with repeated references to &quot;the author&quot;.</i></small> ]
      </p>
      <p class="wrap">
        Designing a successful cryptographic algorithm requires a high level of technical
        knowledge and expertise in areas of advanced mathematics.  (Introductions to
        cryptography abound with cautionary tales of how tortuously clever ciphers devised by
        non-experts invariably turn out to be easy to crack.)  I&apos;m not a cryptographer and
        I don&apos;t have the ability to design secure cryptographic algorithms, so I wrote the
        encryption engine of the Qana application by implementing established algorithms that
        are in the public domain.
      </p>
      <p class="wrap">
        The core cryptographic algorithms that are implemented in Qana &mdash; the <a
        class="external" href="https://en.wikipedia.org/wiki/Scrypt">scrypt</a> key-derivation
        function, and the <a class="external"
        href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES-256</a> and <a
        class="external" href="https://en.wikipedia.org/wiki/Salsa20">Salsa20</a> ciphers on
        which the <a class="external"
        href="https://en.wikipedia.org/wiki/Fortuna_%28PRNG%29">Fortuna</a> cryptographically
        secure pseudo-random number generator is based &mdash; are well-regarded: no successful
        practical attack on any of them of them has been published, and the known weaknesses of
        the AES cipher are not currently significant.  However, owing to advances in technology
        and the effort that is expended on cryptanalysis by corporations and the agencies of
        nation states, it is possible that the algorithms will eventually be broken; if this
        happens, Qana will be one of the smaller casualties.
      </p>
      <p class="wrap">
        Although the cryptographic algorithms themselves are considered to be secure, there are
        likely to be weaknesses in their implementation in Qana that make them vulnerable to <a
        class="external" href="https://en.wikipedia.org/wiki/Side_channel_attack">side-channel
        attacks</a>.  There may also be weaknesses in the structure of Qana&apos;s encrypted
        output; for example, it&apos;s possible that information about the encryption key could
        leak from encrypted metadata.
      </p>
      <p class="wrap">
        Users of a piece of software can often assess its functional quality just by using it:
        if it does what is expected of it without error or undesirable side effects and with
        acceptable speed, it&apos;s probably fit for purpose.  In contrast, the quality of
        cryptographic software can be accurately assessed only by those with expert knowledge.
        The deficiencies of such software may remain hidden until a user discovers that someone
        has breached its purported security, at which point it may be too late to choose better
        software.
      </p>
      <p class="wrap">
        A necessary (but not sufficient) way to test the security of Qana is to publish it and
        hope that, if anyone finds weaknesses in it, he or she will take the trouble to report
        the problems to me.  The obvious defect with this approach is that, like Blanche Dubois,
        it depends on the kindness of strangers.  A large class of cryptanalysts will want to
        keep news of their success in breaking an encryption system to themselves and their
        employers; others may be induced to try to break a cipher only by the offer of a prize
        for succeeding.  The remaining altruists are likely to be motivated to spend their time
        analysing encryption software in proportion to its popularity.  As a result, the
        adoption of new encryption software may never reach critical mass: the software
        isn&apos;t subjected to cryptanalysis because it&apos;s not popular, it&apos;s not
        popular because it&apos;s not trusted, and it&apos;s not trusted because it hasn&apos;t
        been subjected to cryptanalysis.
      </p>
      <p class="wrap">
        At this early stage in the public life of the Qana application, I can recommend only
        that you investigate other, more established encryption software as an alternative to
        Qana.  (For example, <a class="external" href="https://gnupg.org/">GnuPG</a> and
        graphical front ends for it are available for various platforms.)  In terms of security,
        the one advantage that Qana might have over established alternatives is that, because of
        its unpopularity, anyone considering attacking it would probably conclude that the
        benefit of cracking it would be outweighed by the cost of trying, which is a tenuous and
        risky kind of security to offer.
      </p>
      <p class="wrap">
        What, then, is the value of a piece of encryption software that was written by someone
        without expert knowledge of cryptography?  The short answer may be <i>not much</i>.  On
        the other hand, it may be that Qana provides reliable encryption of a relatively high
        strength, assuming that the core cryptographic algorithms have been implemented
        correctly and that there are no significant weaknesses in the structure of Qana&apos;s
        encrypted output.  I am confident that the first of these assumptions is valid (the
        implementations of the algorithms pass unit tests with standard test vectors), but my
        lack of relevant expertise doesn&apos;t allow me to be confident of the second
        assumption.  Leaving aside the questionable functional value of Qana, the source code
        may at least provide reference implementations of the key cryptographic algorithms, and
        it may serve as a framework on which other people can build a better encryption
        application.
      </p>

      <h3 id="section1-5">1.5&nbsp; The name <i>Qana</i></h3>

      <p class="wrap">
        The program is named after a village in southern Lebanon that has had the misfortune to
        have been attacked twice by the Israel Defense Forces (IDF) in separate incidents ten
        years apart.  In April 1996, the IDF <a class="external"
        href="https://en.wikipedia.org/wiki/Qana_massacre">shelled</a> a United Nations compound
        near Qana, killing 106 of the civilians that had taken refuge there.  Then, in July
        2006, the IDF <a class="external"
        href="https://en.wikipedia.org/wiki/Qana_airstrike">bombed</a> a building near the
        village, killing 28 of the civilians that were sheltering inside it.  The number of
        people injured in the two attacks was about the same as the number of people killed.  In
        2004, the present author chose the name Qana for a predecessor of the current
        cryptographic application after reading about the 1996 shelling of the village in Robert
        Fisk&apos;s book, <i>Pity the nation: Lebanon at war</i> (3rd ed., Oxford University
        Press, 2001; ISBN 0192801309).  As a name for a piece of software, <i>Qana</i> has the
        virtue of being short and distinctive.
      </p>

    </div>

    <!--=====================================================================================-->

    <!-- Building and running the application -->

    <div class="section">
      <h2 id="section2">2&nbsp; Building and running the application</h2>
      <p class="tocLink">
        [ <a href="#toc">Table of contents</a> ]
      </p>

      <p class="wrap">
        This section assumes that you have some experience of building and running a Java
        application.
      </p>

      <h3 id="section2-1">2.1&nbsp; Building the application</h3>

      <p class="wrap">
        A Java Development Kit (JDK) that supports Java 17, such as <a class="external"
        href="https://adoptium.net/">Eclipse Temurin from Adoptium</a>, is required to build
        Qana.
      </p>
      <p class="wrap">
        The <code>src</code> directory of the repository contains all the source code and
        resources that constitute the application; there are no external dependencies.  The
        directory conforms to the Maven standard directory layout: the source code is in
        <code>src/main/java</code> and the resources are in <code>src/main/resources</code>.
      </p>
      <p class="wrap">
        The supplied Kotlin-DSL-based <a class="external" href="https://gradle.org/">Gradle</a>
        build script, <code>build.gradle.kts</code>, modifies the <code>compileJava</code> and
        <code>jar</code> tasks (provided by the <code>java</code> plug-in) to compile the
        application and to create an executable JAR file for it.
      </p>

      <h3 id="section2-2">2.2&nbsp; Running the application</h3>

      <p class="wrap">
        The supplied Kotlin-DSL-based Gradle build script, <code>build.gradle.kts</code>,
        defines two tasks that may be used to run Qana:
      </p>
      <dl class="basic">
        <dt>runMain</dt>
        <dd class="wrap">
          Runs the main class from the class files that were generated by the
          <code>compileJava</code> task.
        </dd>
        <dt>runJar</dt>
        <dd class="wrap">
          Runs the executable JAR that was generated by the <code>jar</code> task.
        </dd>
      </dl>
      <p class="wrap">
        Both tasks extend the <code>JavaExec</code> task.
      </p>

      <p class="wrap">
        To prevent a new instance of the application from being run each time a file that is <a
        href="#section2-3">associated with Qana</a> is opened from, for example, a file browser,
        only one instance of Qana may be run at any one time.  When Qana starts up, it checks
        whether another instance of the program is running; if it finds one, it terminates after
        informing the the other instance of any files that should be opened.
      </p>

      <h3 id="section2-3">2.3&nbsp; Associating file types with Qana</h3>

      <p class="wrap">
        Qana may be run indirectly by associating file types with its JAR file and opening a
        file of one of those types.  File associations can be created on Windows with the <a
        class="command" href="#section8-7-2">Options &gt; Manage file associations</a> command.
        You can use the same command to remove the file association when you no longer want it.
      </p>

    </div>

    <!--=====================================================================================-->

    <!-- Configuration -->

    <div class="section">
      <h2 id="section3">3&nbsp; Configuration</h2>
      <p class="tocLink">
        [ <a href="#toc">Table of contents</a> ]
      </p>

      <p class="wrap">
        When it starts up, Qana is configured with <i>configuration properties</i> that are read
        from two sources: the <a href="#section3-1">command line</a> of the Java launcher and a
        <a href="#section3-2">configuration file</a> whose location may be explicitly specified.
        If the same property is specified on the command line and in a configuration file, the
        value from the configuration file takes precedence.
      </p>
      <p class="wrap">
        The recommended method of setting the properties in a configuration file is with the <a
        class="command" href="#section8-7-3">Options &gt; Preferences</a> command.  For
        command-line properties, which must be edited manually, the form of the property values
        is given in an <a href="#sectionB">appendix</a>, and it can also be inferred by
        generating a configuration file with the desired values and inspecting the contents of
        the file.
      </p>

      <h3 id="section3-1">3.1&nbsp; Command-line properties</h3>

      <p class="wrap">
        When Qana is run, configuration properties may be passed to the <code>java</code>
        launcher on the command line as system properties; eg,
        <code>-Dapp.general.mainWindowLocation=&quot;100, 0&quot;</code>.  Qana&apos;s
        command-line configuration properties all have the prefix <code>app.</code> . A list of
        all the properties that are recognised by Qana is given in an <a
        href="#sectionB">appendix</a>.
      </p>
      <p class="wrap">
        System properties can be added to the <a href="#section2-2">two supplied Gradle
        tasks</a>, <code>runMain</code> and <code>runJar</code>, with the
        <code>systemProperties(Map&lt;String, ?&gt;)</code> method.
      </p>
      <p class="wrap">
        One particular property, <span class="configProperty">app.configDir</span>, is used to
        specify the directory that contains a configuration file, as <a
        href="#section3-2-1">described below</a>.
      </p>

      <h3 id="section3-2">3.2&nbsp; Configuration file</h3>

      <p class="wrap">
        The configuration file is named <code>qana-config.xml</code>.  Qana doesn&apos;t require
        a configuration file: it uses a default value for any configuration property that is
        missing from the source(s) of configuration.  Similarly, if it finds a property value to
        be invalid, Qana will display a message to this effect and use the default value of the
        property.  If the configuration file contains a property that was specified on the
        command line, the value from the configuration file is used.
      </p>
      <p class="wrap">
        If the configuration has changed when you exit the application normally (ie, using the
        <a class="command" href="#section8-1-16">File &gt; Exit</a> command or an equivalent),
        Qana will save its configuration to a configuration file.  If a configuration file was
        read on startup, it will overwrite that file; otherwise, it will write a configuration
        file to the default directory described above, unless the value of the <span
        class="configProperty">app.configDir</span> property was an empty string.
      </p>
      <p class="wrap">
        A configuration file can be written explicitly with the <span class="command">Save
        configuration</span> command within the <span class="component">Preferences</span>
        dialog.
      </p>

      <h4 id="section3-2-1">3.2.1&nbsp; Location of the configuration file</h4>
      <p class="wrap">
        When it starts up, Qana is informed of the location of the configuration file with the
        <span class="configProperty">app.configDir</span> property.  The value of the property
        may contain <a href="#sectionB">special constructs</a> for system properties,
        environment variables and the user&apos;s home directory.
      </p>
      <p class="noBottomMargin wrap">
        The <span class="configProperty">app.configDir</span> property may be set in two ways:
      </p>
      <ul class="continuationList">
        <li class="wrap">
          on the command line that runs the <code>java</code> launcher, or
        </li>
        <li class="wrap">
          in a file named <code>qana-properties.xml</code> that resides in the same directory as
          the <code>qana.jar</code> JAR file.
        </li>
      </ul>
      <p class="wrap">
        The <code>qana-properties.xml</code> file is a legacy from the time when Qana was
        distributed as a JAR file with an installer; the properties file was written by the
        installer.  If you create a properties file, it should have the following form, with the
        example pathname replaced by the actual pathname:
      </p>
      <pre class="codeFragment">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;
&lt;!DOCTYPE properties SYSTEM &quot;http://java.sun.com/dtd/properties.dtd&quot;&gt;
&lt;properties&gt;
&lt;entry key=&quot;app.configDir&quot;&gt;/home/slothrop/.blankaspect/qana&lt;/entry&gt;
&lt;/properties&gt;</pre>

      <p class="wrap">
        If the <span class="configProperty">app.configDir</span> property is set both on the
        command line and in the properties file, the value in the properties file takes
        precedence.
      </p>

      <p class="wrap">
        The existence and value of the <span class="configProperty">app.configDir</span>
        property determines the locations that are searched for a configuration file:
      </p>
      <ul class="list">
        <li class="spaced wrap">
          If the <span class="configProperty">app.configDir</span> property exists and the
          property value is an empty string, Qana will start without a configuration file.  No
          configuration file will be written when the application exits.
        </li>
        <li class="spaced wrap">
          If the <span class="configProperty">app.configDir</span> property exists and the
          property value is not empty, Qana will look for a configuration file in the directory
          specified by the property.  An error message is displayed if a configuration file is
          not found in the specified directory.
        </li>
        <li class="spaced">
          <div class="wrap">
            If the <span class="configProperty">app.configDir</span> property does not exist,
            Qana will look for a configuration file at two other locations:
          </div>
          <ol class="list">
            <li class="spaced">
              <div><i>The current working directory</i></div>
              <div class="wrap">
                The current working directory, which is denoted by the environment variable
                <code>$PWD</code> on Linux/UNIX systems, depends on the system and the way in
                which Qana was run.
              </div>
            </li>
            <li class="spaced" id="defaultDirectory">
              <div><i>The default directory</i></div>
              <div class="wrap">
                On Linux/UNIX systems, the default directory is
                <code>$HOME/.blankaspect/qana</code>, where <code>$HOME</code> is the
                environment variable that denotes the user&apos;s home directory.  On Windows
                systems, the default directory is <code>%APPDATA%\blankaspect\qana</code>, where
                <code>%APPDATA%</code> is an environment variable.
              </div>
            </li>
          </ol>
        </li>
      </ul>

    </div>

    <!--=====================================================================================-->

    <!-- Keys -->

    <div class="section">
      <h2 id="section4">4&nbsp; Keys</h2>
      <p class="tocLink">
        [ <a href="#toc">Table of contents</a> ]
      </p>

      <p class="wrap">
        Keys are an important aspect of Qana &mdash; important enough to warrant their own
        section in this manual.
      </p>
      <p class="noBottomMargin wrap">
        Qana uses two kinds of cryptographic key:
      </p>
      <ul class="continuationList">
        <li class="wrap">
          a key-production key (KPK), called a <i>user key</i> in this document, and
        </li>
        <li class="wrap">
          a content-encryption key (CEK).
        </li>
      </ul>
      <p class="wrap">
        When the term <i>key</i> is used by itself in this document, it generally means <i>user
        key</i>, though its meaning in any particular case should be clear from the context.
      </p>
      <p class="wrap">
        A user key is effectively an alias for a passphrase that is chosen by a user to encrypt
        a file, text or an archive.  The key is a 256-bit number that is generated from a
        passphrase with a <a class="external"
        href="https://en.wikipedia.org/wiki/Cryptographic_hash_function">cryptographic hash
        function</a>, which has the property that it is highly improbable that the same key will
        be generated from two different passphrases.  Sometimes in this document, when the
        distinction is unimportant, <i>key</i> (in the sense of <i>user key</i>) is used as
        though it were synonymous with <i>passphrase</i>.
      </p>
      <p class="wrap">
        User keys are not used directly to encrypt data; their purpose is to produce
        content-encryption keys, which, as their name suggests, are the keys for the stream
        ciphers that are used for encrypting data.  (A content-encryption key is actually the
        seed for a cryptographically secure pseudo-random number generator that generates the
        stream cipher.)
      </p>

      <h3 id="section4-1">4.1&nbsp; The key-derivation function (KDF)</h3>

      <p class="noBottomMargin wrap">
        The key-derivation function (KDF) is one of the cryptographic cornerstones of Qana.
        (The other cornerstone is the Fortuna PRNG.  In this metaphor, Qana is a building with
        only two corners.)  Qana uses the KDF for two purposes:
      </p>
      <ul class="continuationList">
        <li class="wrap">
          <i>Key verification</i> &mdash; to verify a user key against its passphrase, and
        </li>
        <li class="wrap">
          <i><abbr title="Content-encryption key">CEK</abbr> generation</i> &mdash; to generate
          content-encryption keys from a user key.
        </li>
      </ul>
      <p class="wrap">
        The KDF is a <a class="external"
        href="https://en.wikipedia.org/wiki/One-way_function">one-way function</a> that combines
        a key (a passphrase) and <a class="external"
        href="https://en.wikipedia.org/wiki/Salt_%28cryptography%29">salt</a> (a 256-bit random
        number) to give a 2048-bit output, which is either stored in the <a
        href="#section4-3-4">key database</a> for verifying a passphrase or reduced to a 256-bit
        CEK.  The function is deliberately made computationally intensive in the expectation
        that its large resource requirements &mdash; lots of memory, logic blocks or CPU time
        &mdash; will make a <a class="external"
        href="https://en.wikipedia.org/wiki/Brute-force_attack">brute-force attack</a> on the
        key too costly.
      </p>
      <p class="wrap">
        When a CEK is used for encryption, the salt and the values of the KDF parameters that
        were used to generate the CEK are stored as cleartext with the encrypted output so that
        they can be used to initialise the KDF for decryption.  Given the same combination of
        user key and salt, the KDF will always generate the same value, but, because the salt is
        random, it is almost impossible for the same 256-bit CEK to be generated more than once,
        which prevents an attacker from gaining information about a user key or a CEK from
        multiple instances of ciphertext that are known to have been encrypted with the same
        user key.
      </p>
      <p class="wrap">
        Qana uses the <a class="external" href="https://en.wikipedia.org/wiki/Scrypt">scrypt</a>
        function as its KDF.  The time and memory demands of the function can be configured with
        a set of parameters, making the key more secure at the cost of a larger memory
        requirement and/or a longer computation time.  A user key has two sets of these
        parameters, one for each of the KDF&apos;s two purposes: one set of parameters is used
        for generating the value that it stored in a database for verifying the passphrase of
        the key; the other set is used for generating CEKs.  You can configure the two sets of
        parameters independently of each other.
      </p>
      <p class="wrap">
        The implementation of scrypt in Qana is a reference implementation; it&apos;s not
        optimised, either for speed or for reduced memory requirements.
      </p>

      <h4 id="section4-1-1">4.1.1&nbsp; Configuring the key-derivation function</h4>
      <p class="wrap">
        In Qana&apos;s implementation of the scrypt function, its resource requirements &mdash;
        memory usage and the number of processor operations (CPU time) &mdash; are controlled by
        four parameters.  Three of the parameters are part of the scrypt specification; the
        fourth parameter allows the modification of a value that is fixed in the scrypt
        algorithm.
      </p>
      <p class="wrap">
        A fifth parameter, the maximum number of threads used by the KDF, affects the
        performance of the scrypt function but not its result.  It is not included in the set of
        KDF parameters that is stored with the encrypted output of Qana for generating the <abbr
        title="Content-encryption key">CEK</abbr> on decryption.
      </p>
      <p class="wrap">
        The scrypt algorithm and its parameters are described fully in the <a class="external"
        href="https://tools.ietf.org/html/rfc7914">specification of scrypt</a>, though the
        following description of the parameters should suffice for users of Qana.
      </p>
      <dl class="basic">
        <dt id="defKdfNumRounds">Number of rounds</dt>
        <dd class="wrap">
          Within the scrypt function, the lowest level of mixing of the input data (the key and
          salt) is performed by the <i>Salsa20 core</i> &mdash; the non-compressing hash
          function at the core of the <a class="external"
          href="https://en.wikipedia.org/wiki/Salsa20">Salsa20</a> cipher.  The number of rounds
          of the Salsa20 core is fixed at 8 in the scrypt specification, but the Qana
          implementation of the function allows 8, 12, 16 or 20 rounds.  CPU time increases
          linearly with the number of rounds.
        </dd>

        <dt id="defKdfCost">CPU/memory cost</dt>
        <dd class="wrap">
          This parameter is the <a class="external"
          href="https://en.wikipedia.org/wiki/Binary_logarithm">binary logarithm</a> of the
          parameter that is labelled <i>N</i> in the scrypt specification.  In other words, the
          value of <i>N</i> in the scrypt specification is the number 2 raised to the power of
          the value of the parameter in the Qana implementation.  Memory usage and CPU time
          increase exponentially with the cost parameter.
        </dd>

        <dt id="defKdfNumBlocks">Number of blocks</dt>
        <dd class="wrap">
          This parameter is labelled <i>r</i> in the scrypt specification, where it is described
          as <i>block size</i>.  In the Qana implementation, the parameter is named to reflect
          the number of 128-byte subblocks that are processed by the scrypt function rather than
          the overall size of the superblock, but the difference is nominal, not substantive.
          Memory usage and CPU time increase linearly with the number of blocks.
        </dd>

        <dt id="defKdfNumParallelBlocks">Number of parallel superblocks</dt>
        <dd class="wrap">
          This parameter is labelled <i>p</i> in the scrypt specification, where it is described
          as the <i>parallelization parameter</i>.  At the highest level of the scrypt function,
          processing is performed in parallel on the number of superblocks of data denoted by
          this parameter.  The superblocks can be processed independently of each other, which
          makes the set of tasks suitable for concurrent execution.  Memory usage increases
          linearly with the number of parallel superblocks, whereas CPU time depends on the
          level of concurrency.
        </dd>

        <dt id="defKdfNumThreads">Maximum number of threads</dt>
        <dd class="wrap">
          This parameter, which affects the performance of the scrypt function but not its
          result, is not part of the scrypt specification.  The parallel superblocks whose
          number is specified by the previous parameter can be processed concurrently by
          multiple threads; this parameter denotes the maximum number of threads in the thread
          pool.  The number of threads will never exceed the number of parallel superblocks.  If
          the value of this parameter is zero (the default), the maximum number of threads will
          be the number of available processors on the system, which is likely to be what
          you&apos;d want in most cases.
        </dd>
      </dl>

      <h4 id="section4-1-2">4.1.2&nbsp; Salt</h4>
      <p class="wrap">
        A <a class="external"
        href="https://en.wikipedia.org/wiki/Salt_%28cryptography%29">salt</a> is an <a
        class="external"
        href="https://en.wikipedia.org/wiki/Initialization_vector">initialisation vector</a> for
        the key-derivation function: a random input to the function whose purpose is to prevent
        the leakage of information from multiple uses of the same key by ensuring that the KDF
        produces a different derived key every time it is applied to the same input key.  To
        achieve this, the salt must be <i>unique</i>.
      </p>
      <p class="wrap">
        The 256-bit salts that are used as inputs to the KDF are generated by a Fortuna <abbr
        title="Pseudo-random number generator">PRNG</abbr> similar to the one used to generate
        the stream cipher but with an <a href="#section9">entropy</a> input that is intended to
        make the generation of salts truly random.  If the quality of the entropy is
        sufficiently high, the salts will be uniformly distributed and are almost certain to be
        unique.  (By an extension of the <a class="external"
        href="https://en.wikipedia.org/wiki/Birthday_problem">birthday problem</a> in which a
        &quot;year&quot; has 2<sup>256</sup> &asymp; 10<sup>77</sup> days, it can be seen that
        the probability that a PRNG will generate identical 256-bit values in the remaining
        lifetime of the Earth is vanishingly small.)
      </p>
      <p class="wrap">
        Because a salt is required only to be unique, there is no need to keep it secret, so
        salts are stored as cleartext in both the key database and the output from Qana&apos;s
        encryption operations.
      </p>

      <h4 id="section4-1-3">4.1.3&nbsp; Choosing KDF parameters: key strength <i>v</i> cost</h4>
      <p class="wrap">
        As has been mentioned, the key-derivation function is intentionally costly in terms of
        memory usage and processor operations (CPU time).  With the ability <a
        href="#section4-1-1">to configure the KDF</a>, you can trade off the cost of verifying a
        user key or generating a content-encryption key against the strength of the key that is
        being verified or generated: you can have a stronger key if you&apos;re willing to wait
        a bit longer and/or use more memory each time its passphrase is verified or a <abbr
        title="Content-encryption key">CEK</abbr> is generated from it.  You can vary this
        trade-off between different keys &mdash; and also between key verification and CEK
        generation for the same key, since each user key has separate KDF parameters for the two
        uses of the KDF.  (Some variation is redundant.  It is possible, for example, to create
        multiple keys that all have the same passphrase but that differ from one another in
        their KDF parameters &mdash; slow and fast variants, perhaps.  No benefit would be
        gained from such variation, however, because a set of keys with a common passphrase is
        only as strong as its weakest element.)
      </p>
      <p class="wrap">
        At the risk of stating the obvious, you can&apos;t strengthen the encryption of some
        data unless you re-encrypt the data with a stronger key, which is impossible if an
        adversary already has a copy of the ciphertext, so the principal aim when choosing KDF
        parameters for CEK generation should be to achieve the strongest CEKs that are likely to
        be needed over the expected lifetime of the ciphertext that is encrypted with those
        keys.  (A similar aim applies to the choice of KDF parameters for passphrase
        verification.)  This aim should be moderated by considering the costs of the KDF, as
        discussed below.
      </p>
      <p class="wrap">
        The two costs of the KDF &mdash; memory usage and CPU time &mdash; are constrained in
        different ways.  The time that the function takes to run will vary between systems, but
        the constraint is essentially a human one: how long would it be acceptable for a user on
        the slowest system to wait for a key to be verified or a <abbr
        title="Content-encryption key">CEK</abbr> to be generated?  The memory usage of the KDF,
        on the other hand, has an absolute bound: the required amount of memory is either
        available on a given system or it isn&apos;t.  You should bear these constraints in mind
        when choosing KDF parameters, and give consideration to the range of systems on which
        the KDF will run.  Whilst it may be annoying when decrypting a file to have to wait a
        few seconds for a CEK to be generated on a slow system, it could be disastrous if there
        were not enough memory to generate the CEK.
      </p>
      <p class="wrap">
        In this context, it is worth noting the differences between the two uses of a KDF
        &mdash; key verification and <abbr title="Content-encryption key">CEK</abbr> generation.
        Key verification is really just a convenience; if you can&apos;t verify a <a
        href="#defPersistentKey">persistent key</a> against a passphrase because your system
        doesn&apos;t have enough memory to run the KDF, it&apos;s no big deal: you can just
        create a <a href="#defTemporaryKey">temporary key</a> with the same passphrase and
        minimal KDF parameter values for verification, and you can use the temporary key for
        encryption and decryption.  In contrast, the KDF parameters that are used to generate a
        CEK become an immutable property of the ciphertext that was encrypted by the CEK: if you
        can&apos;t generate the CEK because your system doesn&apos;t have enough memory to run
        the KDF, you won&apos;t be able to decrypt the ciphertext.  It is critical, therefore,
        that you choose KDF parameters for CEK generation that will allow the ciphertext that is
        encrypted by those CEKs to be decrypted on all the expected target systems.
      </p>
      <p class="wrap">
        You may be able to increase the amount of memory that is available to a Java virtual
        machine from the default value with a command-line option of the Java launcher.  For
        example, the maximum heap size can be specified for the HotSpot <abbr
        title="Java virtual machine">JVM</abbr> by using the <code>-Xmx</code> option on the
        command line of the <code>java</code> tool.
      </p>
      <p class="wrap">
        You can try out sets of KDF parameters with the <span class="command">Generate a test
        key</span> command that can be found in the <span class="component">KDF
        parameters</span> dialog and the parameter panel of the <span
        class="component">Preferences</span> dialog.  The command gives an indication of the
        time it takes for the KDF to run, and it will display an error message if there&apos;s
        not enough memory for the KDF.
      </p>

      <h3 id="section4-2">4.2&nbsp; Ciphers</h3>

      <p class="wrap">
        There are two levels of cipher in Qana&apos;s encryption system.  At the upper level,
        encryption and decryption are performed with a <i>stream cipher</i>, which consists of a
        <a class="external" href="https://en.wikipedia.org/wiki/Keystream">keystream</a> of
        pseudo-random data that is combined with plaintext (for encryption) or ciphertext (for
        decryption) with an <a class="external"
        href="https://en.wikipedia.org/wiki/Exclusive_or">exclusive-OR</a> (XOR) operation.  The
        keystream is generated by a Fortuna pseudo-random number generator from an underlying
        cipher &mdash; referred to here as the <i>base cipher</i>.  Qana provides a choice of
        two such base ciphers: an <a class="external"
        href="https://en.wikipedia.org/wiki/Advanced_Encryption_Standard">AES-256</a> block
        cipher running in counter mode or a <a class="external"
        href="https://en.wikipedia.org/wiki/Salsa20">Salsa20</a> cipher.  (Salsa20 is a stream
        cipher that operates intrinsically on blocks of data in a counter mode.)  There is scope
        for ambiguity in the use of the term <i>cipher</i> in this document because of the two
        levels of cipher, but, for practical purposes, you need consider only the base cipher,
        with its two possible flavours.
      </p>
      <p class="wrap">
        Ciphertext that is generated by one kind of base cipher cannot be decrypted by the other
        kind, so a means of identifying the cipher is stored with the ciphertext.
      </p>
      <p class="wrap">
        The cipher that is used for an encryption operation is determined from a combination of
        two properties of a <a href="#section4-3">user key</a> &mdash; its <a
        href="#section4-2-1">preferred cipher</a> and <a href="#section4-2-2">allowed
        ciphers</a> &mdash; and a global default cipher.  The default cipher is selected with <a
        class="command" href="#section8-6-4">Encryption &gt; Default cipher</a> command.
      </p>

      <h4 id="section4-2-1">4.2.1&nbsp; Preferred cipher</h4>
      <p class="wrap">
        To avoid the need to specify a cipher explicitly for every encryption operation, a <a
        href="#section4-3">user key</a> may have a preferred cipher that will be used
        automatically when encrypting with the key.  A preferred cipher is optional; if a key
        has no preferred cipher, a default cipher will be used as long as it is in the set of a
        key&apos;s <a href="#section4-2-2">allowed ciphers</a>.
      </p>
      <p class="wrap">
        A preferred cipher may be selected when a key is created, and it can be edited
        subsequently with the <a class="command" href="#section8-6-5">Encryption &gt; Edit
        keys</a> command.
      </p>

      <h4 id="section4-2-2">4.2.2&nbsp; Allowed ciphers</h4>
      <p class="wrap">
        If you don&apos;t specify a <a href="#section4-2-1">preferred cipher</a> for a key, the
        default cipher will be used for encryption.  In this case, you might want to restrict
        the ciphers that can be used; to do so, you can specify a set of allowed ciphers to
        which the default cipher must belong.  An error message will be displayed if you try to
        encrypt with a default cipher that isn&apos;t allowed by the key.  A key may have an
        empty set of allowed ciphers if it will be used only for decryption.
      </p>
      <p class="wrap">
        The set of allowed ciphers is specified when a key is created, and it can be edited
        subsequently with the <a class="command" href="#section8-6-5">Encryption &gt; Edit
        keys</a> command.
      </p>

      <h4 id="section4-2-3">4.2.3&nbsp; Choice of cipher</h4>
      <p class="wrap">
        In terms of performance, there is not much to choose between the AES-256 and Salsa20
        ciphers in their Qana implementations: in a comparative test that was performed on only
        one system, AES-256 took about 3% longer than Salsa20 to encrypt a set of files.  (This
        should not be taken as a measure of the relative performance of the two ciphers when
        they are used normally, not as the base cipher of a PRNG.)
      </p>
      <p class="wrap">
        From the perspective of security, AES-256 is the safer choice: implementations of the
        Fortuna PRNG commonly use an AES cipher running in counter mode whereas Salsa20 is not
        being used as it was intended.  The author knows of no cryptanalysis of the use of the
        Salsa20 cipher in an implementation of Fortuna.  With this in mind, it is recommended
        that AES-256 be used as the base cipher.
      </p>
      <p class="wrap">
        The choice of AES-256 and Salsa20 as the base ciphers of the Fortuna PRNG in Qana is
        discussed in an <a href="#sectionC">appendix</a>.
      </p>

      <h3 id="section4-3">4.3&nbsp; User keys</h3>

      <p class="wrap">
        A user key associates a name with a <a href="#section4-3-1">passphrase</a> and some
        properties:
      </p>
      <ul class="list">
        <li class="spaced wrap">
          The sets of parameters for the two uses of the <a href="#section4-1">key-derivation
          function</a>.  (One generates a hash value that is used to verify the user key; the
          other generates content-encryption keys from the user key.)
        </li>
        <li class="spaced wrap">
          A set of <a href="#section4-2-2">allowed ciphers</a>.
        </li>
        <li class="spaced wrap">
          A <a href="#section4-2-1">preferred cipher</a>.
        </li>
      </ul>
      <p class="wrap">
        When you perform a cryptographic operation in Qana, you must provide a passphrase that
        will be used to encrypt or decrypt the data.  If you are performing multiple encryptions
        or decryptions with the same passphrase, it would be tiresome and error-prone to have to
        enter the passphrase every time, so Qana allows you to select a key that is associated
        with the passphrase.  You must enter the passphrase to verify the key when you first
        select it during a Qana session; thereafter, whenever the key is required in the same
        session, you can select it without having to enter its passphrase.
      </p>
      <p class="wrap">
        There are two kinds of user key with differing lifespans:
      </p>
      <ul class="list">
        <li class="spaced wrap" id="defPersistentKey">
          A <i>persistent key</i> is a key with an explicit name that is stored in a <a
          href="#section4-3-4">database</a> between Qana sessions.  Persistent keys are created
          and edited with the <a class="command" href="#section8-6-5">Encryption &gt; Edit
          keys</a> command.  You create a key by specifying its name, <a
          href="#section4-3-1">passphrase</a> and properties (<a href="#section4-1-1">KDF
          parameters</a> and <a href="#section4-2">cipher</a> properties).  You can edit the
          name and properties of an existing key.
        </li>
        <li class="spaced wrap" id="defTemporaryKey">
          A <i>temporary key</i> exists only for the duration of a Qana session and is not
          stored in the key database.  A temporary key is created by selecting the <i>New</i>
          item from the list in a <a href="#section6-2">key-selection dialog</a>.  You specify
          the <a href="#section4-3-1">passphrase</a> and properties (<a href="#section4-1-1">KDF
          parameters</a> and <a href="#section4-2">cipher</a> properties) of the key, and it is
          given a generic name (the prefix &quot;<code>$</code>&quot; followed by a numeric
          index).  You can convert a temporary key into a persistent key by renaming it in the
          dialog that is displayed by the <a class="command" href="#section8-6-5">Encryption
          &gt; Edit keys</a> command.
        </li>
      </ul>
      <p class="wrap">
        The main purpose of a persistent key is to verify the passphrase with which it is
        associated.  To achieve this securely, the passphrase itself is not stored in the key
        database.  Instead, the passphrase is combined with a random <a
        href="#section4-1-2">salt</a> using the same key-derivation function (KDF) that is used
        to derive content-encryption keys, though the two uses of the KDF may have different
        parameters.  The output value of the function is stored in the key database along with
        the salt and the parameters of the KDFs.  The passphrase of a key is verified by
        applying the KDF to the candidate passphrase and the stored salt, and then checking that
        the output from the function matches the stored value.  You can adjust the strength of a
        persistent key by <a href="#section4-1-3">changing its KDF parameters</a>.
      </p>
      <p class="wrap">
        Because the KDF is a <a class="external"
        href="https://en.wikipedia.org/wiki/One-way_function">one-way function</a> (a function
        that is computationally hard to invert), it is not feasible to obtain the passphrase
        from the derived value and the salt.  While this makes the passphrase secure, it also
        means that you won&apos;t be able to recover a passphrase from a persistent key, so,
        after you&apos;ve created a key that you are going to use for encryption, it is
        recommended that you check its passphrase by a procedure such as encrypting some text
        with the key that you&apos;ve just created, then decrypting the ciphertext by creating a
        new (temporary) key with the same passphrase.
      </p>
      <p class="wrap">
        A temporary key may be useful if you want to encrypt or decrypt without the need to name
        a key or store it in the key database.  (If you are using the key only for decryption,
        there&apos;s no need to specify KDF parameters because the required parameters will have
        been stored with the ciphertext.)  If you use a temporary key for encryption, you should
        be careful to enter the passphrase correctly.  Because of the risk of entering the wrong
        passphrase, an optional warning, controlled by the <a class="configProperty"
        href="#cp-crypto-warnTemporaryKey">crypto.warnTemporaryKey</a> configuration property,
        is displayed when encrypting with a temporary key.
      </p>

      <h4 id="section4-3-1">4.3.1&nbsp; Passphrases</h4>

      <p class="wrap">
        A passphrase is a string of characters that is transformed into a user key.  Qana uses a
        symmetric-key cipher, so the same passphrase is used for encryption and decryption.
        Because of this, the security of the cipher relies on keeping the passphrase secret.
      </p>
      <p class="wrap">
        A passphrase may contain any character from the <a class="external"
        href="https://en.wikipedia.org/wiki/Unicode_plane#Basic_Multilingual_Plane">Unicode
        Basic Multilingual Plane</a> except control characters or surrogates.  The maximum
        length of a passphrase is 1024 characters.  (These constraints are imposed by the user
        interface, not by the implementations of the cryptographic algorithms.)
      </p>
      <p class="wrap">
        The design of Qana&apos;s encryption system &mdash; the choice of cryptographic
        algorithms and the structure of the ciphertext and key database &mdash; was aimed at
        reducing weaknesses to the point that the most feasible attack on Qana-encrypted
        ciphertext would be an attack on its passphrase, which can always be mounted against a
        secret-key cipher.  If this aim has been achieved, the passphrase is the weak spot in
        Qana&apos;s system.  Potential weaknesses lie in several areas, which are discussed in
        the following subsections.
      </p>

      <h5 id="section4-3-1-1">4.3.1.1&nbsp; Choice of passphrase</h5>
      <p class="wrap">
        Two common attacks on secret passphrases are <a class="external"
        href="https://en.wikipedia.org/wiki/Dictionary_attack">dictionary attacks</a> and <a
        class="external" href="https://en.wikipedia.org/wiki/Brute_force_attack">brute-force
        attacks</a>.
      </p>
      <p class="wrap">
        You can defend against a dictionary attack by avoiding passphrases that consist of
        unmodified words or words with predictable modifications (eg, replacing occurrences of
        the letter <i>O</i> with zero or appending a digit).  You should also avoid predictable
        sequences of letters or digits.
      </p>
      <p class="wrap">
        A brute-force attack, on the other hand, will always succeed, given enough computing
        resources; the aim is to choose a passphrase for which an exhaustive search would be
        impracticable.  A passphrase is transformed by a cryptographic hash function and
        key-derivation function into the 256-bit key of a stream cipher, so it should ideally
        provide at least 256 bits of <a class="external"
        href="https://en.wikipedia.org/wiki/Entropy_%28information_theory%29">entropy</a> for
        the key.  As a guide, if each character of a passphrase were selected randomly from the
        95 printable <a class="external" href="https://en.wikipedia.org/wiki/ASCII">ASCII</a>
        characters with a uniform distribution (ie, each of the 95 characters is equally likely
        to be selected), the passphrase would need to be at least 39 characters long to provide
        the optimal entropy.  This is a best-case example for the specified set of characters;
        in practice, the set will probably contain fewer characters, and they won&apos;t be
        evenly distributed, so a memorable passphrase of the same length will be more
        predictable than this and will therefore contain less entropy.
      </p>

      <h5 id="section4-3-1-2">4.3.1.2&nbsp; Entering a passphrase</h5>
      <p class="wrap">
        A brute-force attack on a strong passphrase is unlikely to succeed, so attackers may
        look for other ways to obtain it.  One well-known approach is to capture a passphrase as
        it is entered by the user, which may be achieved by installing software or hardware on a
        target computer or device to record and report keystrokes, mouse movement and button
        actions, clipboard activity or screenshots.  To thwart keyloggers, Qana allows you to
        enter a passphrase by pasting text into the field of a <a href="#section6-3">passphrase
        dialog</a>.  (A <span class="command">Paste</span> command is available from the
        dialog&apos;s context menu.)  The system clipboard is cleared after each <span
        class="command">Paste</span> command, though this will not provide a defence against the
        logging of clipboard activity.
      </p>

      <h5 id="section4-3-1-3">4.3.1.3&nbsp; Storing a passphrase</h5>
      <p class="wrap">
        A passphrase with a high degree of entropy may not be easily memorable, so there may be
        a temptation to store it in some form; for example, by embedding it in a text file or
        writing it down.  The security risks presented by different methods of storing
        passphrases will vary according to circumstances and will usually be obvious in any
        case.
      </p>

      <h5 id="section4-3-1-4">4.3.1.4&nbsp; Sharing a passphrase</h5>
      <p class="wrap">
        An inherent problem with symmetric-key ciphers like Qana&apos;s is the need for the
        encrypter and decrypter to share the key (or its equivalent, such as a passphrase) if
        the encryption and decryption of data is not done by the same person.  The method of
        sharing the passphrase should be at least as secure as the passphrase itself.  A
        discussion of secure ways to share a passphrase is beyond the scope of this manual
        except for the suggestion that a <a class="external"
        href="https://en.wikipedia.org/wiki/Public-key_cryptography">public-key cryptographic
        system</a> could be used.
      </p>

      <h4 id="section4-3-2">4.3.2&nbsp; Global key</h4>
      <p class="wrap">
        A user key &mdash; either a <a href="#defPersistentKey">persistent key</a> or a <a
        href="#defTemporaryKey">temporary key</a> &mdash; can be selected to be the <i>global
        key</i> with the <a class="command" href="#section8-6-1">Encryption &gt; Set global
        key</a> command.  The global key has no significance by itself, but the <a
        class="command" href="#section8-6-3">Encryption &gt; Automatically use global key</a>
        option can be set so that the global key is used automatically whenever there is a need
        to specify a user key for an encryption or decryption operation.  This may be
        particularly useful when encrypting or decrypting multiple files with drag-and-drop.
      </p>
      <p class="wrap">
        If a global key exists, its name is displayed in a field of the <a
        href="#section6-1-3">status panel</a> of the main window.
      </p>
      <p class="wrap">
        A global key can be cleared with the <a class="command" href="#section8-6-2">Encryption
        &gt; Clear global key</a> command.
      </p>

      <h4 id="section4-3-3">4.3.3&nbsp; Document key</h4>
      <p class="wrap">
        Every open document may have a user key associated with it &mdash; either a <a
        href="#defPersistentKey">persistent key</a> or a <a href="#defTemporaryKey">temporary
        key</a>.  This key, known as a <i>document key</i>, is set when an encryption or
        decryption operation is first performed on a document.  It can also be set explicitly
        with the <a class="command" href="#section8-4-8">Archive &gt; Set key</a> command or <a
        class="command" href="#section8-5-7">Text &gt; Set key</a> command according to the kind
        of document.  When a document key is set, it will be used automatically for subsequent
        encryption or decryption operations on the document until it is cleared or a new key is
        explicitly set.
      </p>
      <p class="wrap">
        If a <a href="#section4-3-2">global key</a> exists and has been set to be used
        automatically, it will take precedence over a document key.
      </p>
      <p class="wrap">
        If a document key exists for the current document, its name is displayed in a field of
        the <a href="#section6-1-3">status panel</a> of the main window.
      </p>
      <p class="wrap">
        A document key can be cleared with the <a class="command" href="#section8-4-9">Archive
        &gt; Clear key</a> command or <a class="command" href="#section8-5-8">Text &gt; Clear
        key</a> command according to the kind of document.
      </p>

      <h4 id="section4-3-4">4.3.4&nbsp; Key database</h4>
      <p class="wrap">
        The key database is a file whose pathname is specified with the <a
        class="configProperty" href="#cp-crypto-keyDatabase">crypto.keyDatabase</a>
        configuration property.  The file is read when Qana starts up, and it is updated when
        the program exits if any persistent keys have been created or any existing keys changed.
      </p>
      <p class="wrap">
        If the specified database file does not exist when the program starts up, a warning is
        displayed.  This will happen after Qana is installed for the first time because the <a
        class="configProperty" href="#cp-crypto-keyDatabase">crypto.keyDatabase</a>
        configuration property has a default value.  When the program exits, a key database will
        be created at the location specified by the configuration property if the file does not
        exist.
      </p>

    </div>

    <!--=====================================================================================-->

    <!-- Documents -->

    <div class="section">
      <h2 id="section5">5&nbsp; Documents</h2>
      <p class="tocLink">
        [ <a href="#toc">Table of contents</a> ]
      </p>

      <p class="wrap">
        Qana supports two kinds of document: <a href="#section5-1">archive documents</a> and <a
        href="#section5-2">text documents</a>.  Each kind document has an associated
        <i>view</i>.
      </p>

      <h3 id="section5-1">5.1&nbsp; Archive documents</h3>

      <p class="wrap">
        In Qana, an archive consists of a set of encrypted files and a database &mdash; a file
        containing information about the files in the archive.  The archive is managed through
        an archive document, which is displayed as an <a href="#section6-1-1">archive view</a>
        in a tab of the main window.  The view has the form of a table in which the rows are the
        files in the archive and the columns are attributes of those files.
      </p>
      <p class="wrap">
        An archive is hierarchical in the sense that its component files may have a directory
        structure that is recreated when the files are extracted from the archive, like the
        contents of a Zip file.  Unlike a Zip file, however, the files in a Qana archive are not
        stored together in a single file; they are stored as separate files in a single
        directory, along with the database file.  Each file in the archive is encrypted with its
        own content-encryption key (CEK) and given a unique name of 64 hexadecimal-digit
        characters to hide its identity.  The name, CEK and original pathname of each file are
        stored, with some additional information about the file, in the archive database, which
        is encrypted with a <a href="#section4-3">user key</a> and stored in the same directory
        as the contents of the archive.  The filename suffix of the database is user-defined and
        defaults to <code>.qarc</code>.  It is configured with the <a class="configProperty"
        href="#cp-file-filenameSuffix-archive">file.filenameSuffix.archive</a> property.
      </p>
      <p class="wrap">
        An archive document has commands for adding files to the archive, extracting files from
        the archive, validating files in the archive and deleting files from the archive.  The
        management of files in the archive should be performed with these commands, not directly
        on the files themselves.
      </p>
      <p class="wrap">
        An archive document is accessed with a single passphrase, which is used to encrypt the
        database file.  The content-encryption key of each file in the archive is randomly
        generated and stored in the database.  The database also contains, for each file, a
        random <a href="#section4-1-2">salt</a> that is used in the generation of the name of
        the encrypted file.  To maximise the security of files in the archive, it is necessary
        to have a high-quality <a href="#section9">entropy</a> input for the <abbr
        title="Pseudo-random number generator">PRNG</abbr> that generates the <abbr
        title="Content-encryption key">CEK</abbr>s and salts.
      </p>

      <h3 id="section5-2">5.2&nbsp; Text documents</h3>

      <p class="wrap">
        Although a text file can be encrypted as a general file, there is also provision in Qana
        for editing and encrypting text as a text document, without the need to store it as a
        file &mdash; and without the <em>ability</em> to store it as a file.  A text document is
        displayed as a <a href="#section6-1-2">text view</a> in a tab of the main window.  The
        view is a text area with some basic <a href="#section8-3">editing commands</a> including
        <a class="command" href="#section8-3-1">Undo/Redo</a>.
      </p>
      <p class="wrap">
        A text document is intended to be used for the rapid composition, encryption and
        decryption of text such as e-mail or <abbr title="Instant messaging">IM</abbr> messages.
        The text content of a document can be transferred between Qana and other applications
        through the system clipboard using copy-and-paste.  If the <a class="configProperty"
        href="#cp-general-clearClipboardOnExit">general.clearClipboardOnExit</a> configuration
        property is set to <code>true</code>, the clipboard is cleared when Qana exits to
        prevent the accidental escape of text that has been copied to the clipboard.
      </p>
      <p class="wrap">
        The text that is currently displayed in a text view may be encrypted with the <a
        class="command" href="#section8-5-2">Text &gt; Encrypt text</a> command.  On encryption,
        the ciphertext replaces the plaintext in the text view.  The ciphertext can be copied
        from the Qana document and pasted into another document &mdash; the body of an e-mail
        message, for example.  Conversely, Qana-encrypted ciphertext may be copied from a source
        and pasted into a text view, then decrypted.
      </p>
      <p class="wrap">
        Encrypted text is encoded as <a class="external"
        href="https://en.wikipedia.org/wiki/Base64">Base64</a>, which may be wrapped as a simple
        XML document if the <a class="command" href="#section8-5-4">Text &gt; Wrap encrypted
        text in XML</a> option is selected.  (<i>Technical note:</i> The Base64 data may contain
        only characters from the 65-character Base64 alphabet, whitespace and line breaks, and
        the end of the data must be padded.)
      </p>

      <h4 id="section5-2-1">5.2.1&nbsp; XML wrapper</h4>
      <p class="wrap">
        When a text document is encrypted, the ciphertext may optionally be enclosed in a simple
        <a class="external" href="https://en.wikipedia.org/wiki/XML">XML</a> document.  The XML
        wrapper serves two purposes: it identifies its contents as Qana-encrypted text (which
        may or may not be desirable), and it delimits the ciphertext so that the <a
        class="command" href="#section8-5-3">Text &gt; Decrypt text</a> command can find it
        within some enclosing text.
      </p>
      <p class="wrap">
        The XML document consists of a single element &mdash; the document element &mdash; whose
        name is <code>qanaText</code> and whose only content is character data that is
        Base64-encoded ciphertext.  The element has a <i>version</i> attribute whose value is
        the version number of the document&apos;s format.
      </p>
      <p class="wrap">
        The <a class="command" href="#section8-5-4">Text &gt; Wrap encrypted text in XML</a>
        option affects the behaviour of the <span class="command">Decrypt</span> command as well
        as the output of the <span class="command">Encrypt</span> command.  If the XML wrapper
        option is not selected, the <span class="command">Decrypt</span> command expects its
        input to be Base64-encoded ciphertext.  If the XML wrapper option is selected, the <span
        class="command">Decrypt</span> command does not expect a well-formed XML document as
        input; instead, it searches the input text for the first <code>&lt;qanaText&gt;</code>
        start tag and the <code>&lt;/qanaText&gt;</code> end tag that follows it, and it
        processes the text between the two tags as though it were an XML element whose text
        content is Base64-encoded ciphertext.  The relaxed form of the input to the <span
        class="command">Decrypt</span> command allows XML-wrapped ciphertext to be included
        within arbitrary text &mdash; embedded in the body of an e-mail message, for instance.
      </p>

    </div>

    <!--=====================================================================================-->

    <!-- The display -->

    <div class="section">
      <h2 id="section6">6&nbsp; The display</h2>
      <p class="tocLink">
        [ <a href="#toc">Table of contents</a> ]
      </p>

      <h3 id="section6-1">6.1&nbsp; The main window</h3>

      <p class="wrap">
        Qana uses a tabbed document interface to display multiple documents.  This kind of
        interface has a single tabbed window in which only one document &mdash; referred to as
        the <i>current document</i> &mdash; is visible at any one time.  Each open document has
        its own view in a tab of the main window: either an <a href="#section6-1-1">archive
        view</a> or a <a href="#section6-1-2">text view</a> according to the kind of document.
        A maximum of 64 documents may be open simultaneously.
      </p>
      <p class="wrap">
        You can select a document by clicking on its tab, or you can select a document from the
        alphabetically ordered list that is displayed by clicking on the down-arrow button at
        the right of the tab bar.  You can move between documents by pressing Ctrl+PageUp and
        Ctrl+PageDown.
      </p>
      <p class="wrap">
        The main window can be moved and resized in a platform-dependent manner (for example, it
        may be possible to change the size by dragging a corner of the window).
      </p>
      <p class="wrap">
        The location and size of the main window can be saved between Qana sessions according to
        preferences for, respectively, <a href="#cp-general-mainWindowLocation">saving the main
        window location</a> and <a href="#cp-general-mainWindowSize">saving the main window
        size</a>.  If the size of the main window is not saved, the window is sized to fit the
        larger of an archive view and a text view, whose sizes are determined indirectly by
        several configuration properties.  The size of an archive view is determined by its <a
        href="#cp-archive-view-numRows">number of viewable rows</a> and the sum of the <a
        href="#cp-archive-view-columnWidth">widths of its visible columns</a>; the size of a
        text view is specified by the <a class="configProperty"
        href="#cp-text-view-size">text.view.size</a> property and the text view <a
        href="#cp-font">font</a>.
      </p>

      <h4 id="section6-1-1">6.1.1&nbsp; Archive view</h4>
      <p class="wrap">
        Information about the files in an archive is displayed in a table of between one and
        four columns: <i>Path</i>, <i>Size</i>, <i>Timestamp</i> and <i>Hash value</i>.  The
        <i>Path</i> column shows the pathname of the file in the archive; any directories in the
        pathname will be created when the file is extracted.  The <i>Size</i> and
        <i>Timestamp</i> columns show those attributes of the original file.  The <i>Hash
        value</i> column shows a cryptographic hash value of the file, which is also the name of
        the encrypted file in the archive directory.
      </p>
      <p class="wrap">
        Several of the archive commands apply only to files whose rows are selected in the
        table.  The number of selected files is displayed in a field of the <a
        href="#section6-1-3">status panel</a>.  The selection of multiple groups of contiguous
        rows is allowed.  None of the cells in the table is editable.
      </p>
      <p class="wrap">
        The up/down arrow in the column header indicates the sort key &mdash; the column that
        determines the order of the rows of the table &mdash; and whether the rows are arranged
        in ascending or descending order.  You can change the sort key and toggle between
        ascending and descending order by clicking on the appropriate column header.
      </p>
      <p class="wrap">
        The initial widths of the four columns and the presence of all columns except the
        <i>Path</i> column are configured with the <a class="configProperty"
        href="#cp-archive-view-columnWidth">archive.view.columnWidth</a> properties.  You can
        set the initial column widths to the current widths with the <span class="command">Set
        from current view</span> command in the <span class="component">Archive view</span> tab
        of the <span class="component">Preferences</span> dialog.  You can change the widths of
        the columns by dragging the separators of the column headers, and you can change the
        order of the columns by dragging the column headers left or right; any changes will
        apply only to the view in which they are made.
      </p>
      <p class="wrap">
        Above the table of archive contents is a panel with a folder icon near its left edge.
        This is the <i>archive directory panel</i> in which the pathname of the directory that
        contains the files of the archive is displayed.  The panel has its own drag-and-drop
        behaviour and a context menu containing a single command for setting the archive
        directory.
      </p>

      <h4 id="section6-1-2">6.1.2&nbsp; Text view</h4>
      <p class="wrap">
        A text view is a multi-line text area in which you can type text and perform the
        standard editing functions of cut, copy and paste.  A simple undo/redo facility is
        available.  The text view does not support any presentational attributes (eg, bold or
        italic font styles).
      </p>
      <p class="wrap">
        The initial dimensions of the text area are specified by the <a class="configProperty"
        href="#cp-text-view-size">text.view.size</a> configuration property.  If the initial
        dimensions of the <a href="#section6-1-1">archive view</a> are greater than those of the
        text view, the initial dimensions of the text view will be increased to those of the
        archive view.
      </p>
      <p class="wrap">
        The foreground (text) and background colours of the text view can be configured with
        several <a href="#cp-text-view-colour">colour properties</a>.  The <a
        href="#cp-font">font</a> that is used in the text view can also be configured.
      </p>

      <h4 id="section6-1-3">6.1.3&nbsp; Status panel</h4>
      <p class="wrap">
        At the bottom of the main window, below the tabbed document panel, is a status panel
        comprising five fields, some of which may be empty.  The fields have the following
        contents:
      </p>
      <ol class="list">
        <li class="spaced wrap">
          Pseudo-random number generator status: a green tick is shown if enough <a
          href="#section9">entropy</a> has accumulated to reseed the PRNG; otherwise, a red
          cross is shown.
        </li>
        <li class="spaced wrap">
          The name of the <a href="#section4-2">cipher</a> &mdash; AES-256 or Salsa20 &mdash;
          that will be used by default for encryption with a user key that does not have a
          preferred cipher.
        </li>
        <li class="spaced wrap">
          The name of the <a href="#section4-3-2">global key</a>, if one has been set.
        </li>
        <li class="spaced wrap">
          The name of the <a href="#section4-3-3">document key</a>, if one has been set.
        </li>
        <li class="spaced">
          <div class="wrap">
            <i>Archive documents:</i> the number of files selected in the table.
          </div>
          <div class="wrap">
            <i>Text documents:</i> the timestamp of the last ciphertext to be decrypted in the
            current document.
          </div>
        </li>
      </ol>

      <h3 id="section6-2">6.2&nbsp; Key-selection dialog</h3>

      <p class="wrap">
        Qana has a standard dialog box for selecting a <a href="#section4-3">user key</a> for
        encryption or decryption.  Most of the dialog is taken up by a list of available keys.
        Each item in the list consists of the name or generic designation of a key and an icon
        that indicates the kind of key or its status.
      </p>
      <p class="wrap">
        The first item in the list is always <i>New</i>, which creates a new <a
        href="#defTemporaryKey">temporary key</a>.  If you select <i>New</i>, you will have to
        enter a <a href="#section4-3-1">passphrase</a> and properties for the new key &mdash;
        two sets of <a href="#section4-1-1">KDF parameters</a>, a <a
        href="#section4-2-1">preferred cipher</a> and a set of <a href="#section4-2-2">allowed
        ciphers</a> &mdash; in the dialogs that follow.  A temporary key will be created with a
        generic name, and it will be available for selection the next time a key-selection
        dialog is displayed.
      </p>
      <p class="wrap">
        Any temporary keys that are in existence are listed immediately below the <i>New</i>
        item.  Temporary keys have a generic name consisting of the prefix
        &quot;<code>$</code>&quot; followed by a numeric index.  If you select a temporary key,
        you will not have to verify its passphrase because you will have entered the passphrase
        when the key was created.
      </p>
      <p class="wrap">
        Any remaining keys in the list are <a href="#defPersistentKey">persistent keys</a>.  A
        tick next to the name of the key indicates that the passphrase of the key has been
        verified during the current Qana session.  If you select a persistent key whose
        passphrase has not yet been verified, you will have to enter the passphrase in the <a
        href="#section6-3">dialog</a> that follows.
      </p>

      <h3 id="section6-3">6.3&nbsp; Passphrase dialog</h3>

      <p class="wrap">
        Qana has a standard dialog box for entering the passphrase of a <a
        href="#section4-3">user key</a> when creating or verifying the key.  The dialog consists
        mainly of a single field in which you enter the passphrase.  When the dialog is
        displayed, the characters that you enter in the passphrase field are hidden; you can
        make them visible by issuing the <span class="command">Show</span> command from the
        button adjacent to the field or from the dialog&apos;s context menu.  The text of the
        button changes to <span class="command">Hide</span> when the contents of the passphrase
        field are visible.
      </p>
      <p class="wrap">
        The dialog has a <span class="command">Paste</span> command, which can be issued through
        the dialog&apos;s context menu or by pressing Ctrl+V when the passphrase field has
        keyboard focus.  The command pastes text from the system clipboard into the passphrase
        field, then clears the clipboard.
      </p>
      <p class="wrap">
        The passphrase field will accept any character from the <a class="external"
        href="https://en.wikipedia.org/wiki/Unicode_plane#Basic_Multilingual_Plane">Unicode
        Basic Multilingual Plane</a> except control characters or surrogates.  The maximum
        length of a passphrase is 1024 characters.
      </p>

      <h3 id="section6-4">6.4&nbsp; Drag-and-drop</h3>

      <p class="wrap">
        If your system supports the dragging and dropping of files (for example, from a file
        manager such as GNOME Nautilus or Windows Explorer), there are several areas of
        Qana&apos;s main window and dialog boxes that you can drag and drop files or directories
        onto.
      </p>

      <h4 id="section6-4-1">6.4.1&nbsp; Drag-and-drop support in the main window</h4>
      <p class="wrap">
        You can drag and drop multiple files onto all areas of the main window except for the
        archive directory panel of an archive view, which has special drag-and-drop behaviour
        for setting the archive directory.  The action that results from dragging and dropping
        files onto the main window depends on the filename suffix of each file and on some
        configuration properties:
      </p>
      <ol class="list">
        <li class="spaced wrap">
          If a file has the filename suffix specified by the <a class="configProperty"
          href="#cp-file-filenameSuffix-archive">file.filenameSuffix.archive</a> configuration
          property, which defaults to <code>.qarc</code>, the file is opened as an archive
          document.
        </li>
        <li class="spaced wrap">
          If a file has the filename suffix specified by the <a class="configProperty"
          href="#cp-file-filenameSuffix-encrypted">file.filenameSuffix.encrypted</a>
          configuration property, which defaults to <code>.qana</code>, the file is either
          decrypted or validated according to the value of the <a class="configProperty"
          href="#cp-general-encryptedFileDragAndDropAction">general.encryptedFileDragAndDropAction</a>
          configuration property.
        </li>
        <li class="spaced wrap">
          Otherwise, the file is encrypted.
        </li>
      </ol>
      <p class="wrap">
        If the drag-and-drop action is to encrypt or decrypt the file and the <a
        class="configProperty"
        href="#cp-file-selectEncryptDecryptOutputFile">file.selectEncryptDecryptOutputFile.dragAndDrop</a>
        configuration property is set to <code>true</code>, a dialog box is displayed in which
        you can select the output file; otherwise, the output file will be in the same directory
        as the input file and its name will be derived from that of the input file.
      </p>

      <h3 id="section6-5">6.5&nbsp; Graphical components in dialog boxes</h3>

      <p class="wrap">
        Dialog boxes are displayed in response to some of Qana&apos;s commands.  Some of the
        dialogs contain non-standard graphical components or standard components that have
        unusual features.
      </p>

      <h4 id="section6-5-1">6.5.1&nbsp; Spinner</h4>
      <p class="noBottomMargin wrap">
        A <i>spinner</i> is a graphical component for editing a numerical value.  It consists of
        a text field adjacent to a pair of small buttons.  The value in the text field may be
        edited manually, or it may be incremented and decremented by one of the following
        methods:
      </p>
      <ul class="continuationList">
        <li class="wrap">
          clicking on the small up/down buttons;
        </li>
        <li class="wrap">
          pressing the up/down arrow keys;
        </li>
        <li class="wrap">
          rotating the mouse wheel with the mouse cursor over the spinner when the text field
          has keyboard focus (ie, the caret is displayed in the field).
        </li>
      </ul>
      <p class="wrap">
        Using the last two methods, the amount by which the value is incremented or decremented
        can be modified by holding down the Ctrl, Shift or Ctrl+Shift keys, which correspond to
        increments of 10, 100 and 1000 respectively.
      </p>

      <h4 id="section6-5-2">6.5.2&nbsp; Pathname field</h4>
      <p class="wrap">
        A <i>pathname field</i> is a text field that is intended to hold the pathname of a file
        or directory.  The browse button (<span class="component">&hellip;</span>) adjacent to
        the field brings up a file-selection dialog whose selection will be displayed in the
        field if the dialog is accepted.
      </p>
      <p class="wrap">
        The pathname in the field may contain <a href="#sectionA">special constructs</a> for
        system properties, environment variables and the user&apos;s home directory.
      </p>
      <p class="wrap">
        You can transfer a file or directory to a pathname field by drag-and-drop or by
        copy-and-paste from a file manager.
      </p>

    </div>

    <!--=====================================================================================-->

    <!-- Cryptographic functions -->

    <div class="section">
      <h2 id="section7">7&nbsp; Cryptographic functions</h2>
      <p class="tocLink">
        [ <a href="#toc">Table of contents</a> ]
      </p>

      <p class="wrap">
        Qana provides several cryptographic functions, each of which has a complementary pair of
        commands for encryption and decryption:
      </p>
      <ul class="list">
        <li class="wrap">
          Encrypt a file.
        </li>
        <li class="wrap">
          Encrypt text.
        </li>
        <li class="wrap">
          Manage an archive (a hierarchical collection of encrypted files, which are stored with
          generic names).
        </li>
        <li class="wrap">
          Encrypt a file and conceal it in an image file.
        </li>
        <li class="wrap">
          Encrypt text and conceal it in an image file.
        </li>
        <li class="wrap">
          Split a file into an encrypted set of files with generic names.
        </li>
      </ul>
      <p class="wrap">
        This section describes the various functions, some aspects of which are described in
        more detail in other sections.
      </p>

      <h3 id="section7-1">7.1&nbsp; Encrypting a file</h3>

      <p class="wrap">
        A file can be encrypted with the <a class="command" href="#section8-1-8">File &gt;
        Encrypt file</a> command.  A file that has been encrypted in this way can be decrypted
        with the <a class="command" href="#section8-1-9">File &gt; Decrypt file</a> command.
        The integrity of an encrypted file can be checked with the <a class="command"
        href="#section8-1-10">File &gt; Validate file</a> command.  All three commands appear in
        the main context menu as well as the main menu.
      </p>
      <p class="wrap">
        By default, an encrypted file is given the name of the input file with a user-defined
        suffix, which defaults to <code>.qana</code>.  (For example, a file named
        <code>mySecretDiary.odt</code> would be encrypted as
        <code>mySecretDiary.odt.qana</code>.) The filename suffix is configured with the <a
        class="configProperty"
        href="#cp-file-filenameSuffix-encrypted">file.filenameSuffix.encrypted</a> property.
      </p>
      <p class="wrap">
        Multiple files can be encrypted and decrypted by <a href="#section6-4-1">dragging and
        dropping</a> them onto the main window.
      </p>

      <h3 id="section7-2">7.2&nbsp; Encrypting text</h3>

      <p class="wrap">
        Although a text file can be encrypted as a general file, there is also provision for
        encrypting text as a <a href="#section5-2">text document</a>, without the need to store
        it as a file.  A text document is created with the <a class="command"
        href="#section8-5-1">Text &gt; New text</a> command, which opens a new text view in a
        tab of the main window.  The view is a text area with some basic editing facilities
        including <a class="command" href="#section8-3-1">Undo/Redo</a>.
      </p>
      <p class="wrap">
        Text can be transferred between the Qana document and other applications through the
        system clipboard using copy-and-paste.  If the <a class="configProperty"
        href="#cp-general-clearClipboardOnExit">general.clearClipboardOnExit</a> configuration
        property is set to true, the clipboard is cleared when Qana exits to prevent the
        accidental escape of plaintext that has been copied to the clipboard.
      </p>
      <p class="wrap">
        The text of a text document can be encrypted with the <a class="command"
        href="#section8-5-2">Text &gt; Encrypt text</a> command, and encrypted text can be
        decrypted with the <a class="command" href="#section8-5-3">Text &gt; Decrypt text</a>
        command.  Encrypted text is encoded as Base64, which will be wrapped as a simple XML
        document if the <a class="command" href="#section8-5-4">Text &gt; Wrap encrypted text in
        XML</a> option is selected.
      </p>
      <p class="wrap">
        When text is encrypted, the current time is included in the ciphertext.  When the
        ciphertext is decrypted, the timestamp is displayed in a field of the <a
        href="#section6-1-3">status panel</a> below the text view.
      </p>
      <p class="wrap">
        More details on the encryption of text can be found in the sections on <a
        href="#section5-2">text documents</a>, <a href="#section8-3"><span
        class="component">Edit</span> menu commands</a> and <a href="#section8-5"><span
        class="component">Text</span> menu commands</a>.
      </p>

      <h3 id="section7-3">7.3&nbsp; Managing an archive of encrypted files</h3>

      <p class="wrap">
        An archive denotes a collection of encrypted files that is managed through an <a
        href="#section5-1">archive document</a>.
      </p>

      <h4 id="section7-3-1">7.3.1&nbsp; Creating a new archive</h4>
      <p class="noBottomMargin wrap">
        An archive document is created with the <a class="command" href="#section8-1-1">File
        &gt; New archive</a> command, which opens a new archive view in a tab of the main
        window.  Before you can add files to the archive, you must specify the archive directory
        &mdash; the directory in which the contents of the archive and the database will be
        stored.  The archive directory is shown in the panel below the document tab in the main
        window.  You can specify the archive directory by the following methods:
      </p>
      <ul class="continuationList">
        <li class="wrap">
          select a directory from the file-selection dialog that is displayed in response to the
          <a class="command" href="#section8-4-1">Archive &gt; Choose archive directory</a>
          command,
        </li>
        <li class="wrap">
          select a directory from the file-selection dialog that is displayed in response to
          clicking the mouse on the archive directory panel,
        </li>
        <li class="wrap">
          drag and drop a directory from a file manager onto the archive directory panel, or
        </li>
        <li class="wrap">
          copy a directory from a file manager and paste it into the archive directory panel
          with the <span class="command">Paste</span> command from the panel&apos;s context
          menu.
        </li>
      </ul>
      <p class="wrap">
        You can change the archive directory only while the archive is empty.
      </p>

      <h4 id="section7-3-2">7.3.2&nbsp; Opening an archive</h4>
      <p class="wrap">
        You can open an existing archive with the <a class="command" href="#section8-1-2">File
        &gt; Open archive</a> command, which brings up a file-selection dialog in which you can
        choose the archive database file to open.  Alternatively, you can drag and drop an
        archive database file onto the main window.  (An archive database is recognised by
        having the filename suffix that is specified by the <a class="configProperty"
        href="#cp-file-filenameSuffix-archive">file.filenameSuffix.archive</a> configuration
        property.)
      </p>
      <p class="wrap">
        A key-selection dialog will be displayed in which you can choose the key that will be
        used to decrypt the archive database.  If the database is successfully decrypted, it
        will be opened as an archive document in a tab of the main window.
      </p>
      <p class="wrap">
        When an archive is opened, the directory containing the database file will be set as the
        archive directory and the existence of all the files in the database will be checked.
        The entry of any file that cannot be found in the archive directory will be deleted from
        the database and an error message displayed to this effect, followed by a list of
        missing files.  If you then save the archive, the missing files will become permanently
        inaccessible because their encryption keys, which were randomly generated and stored in
        the database, will be lost forever.  If the files are missing temporarily from the
        archive directory (eg, because you are splitting an archive), it important that you make
        a backup copy of the archive database file before you save it with the entries for the
        missing files deleted.
      </p>

      <h4 id="section7-3-3">7.3.3&nbsp; Adding files to an archive</h4>
      <p class="noBottomMargin wrap">
        To add files to the archive, issue the <a class="command" href="#section8-4-2">Archive
        &gt; Add files</a> command, which will bring up a dialog box in which you can select the
        files that you want to add.  Within the dialog, you can select files by the following
        methods:
      </p>
      <ul class="continuationList">
        <li class="wrap">
          select files from the file-selection dialog that is displayed in response to the <span
          class="command">Add</span> command,
        </li>
        <li class="wrap">
          drag files from a file manager and drop them onto the <span class="component">Input
          files</span> list box, or
        </li>
        <li class="wrap">
          copy files from a file manager and paste them into the <span class="component">Input
          files</span> list box.
        </li>
      </ul>
      <p class="wrap">
        All three methods allow you to select directories as well as files.  If you select a
        directory, all the files below the directory (ie, all the files in the directory itself
        and, recursively, in any of its subdirectories) will be selected, and the files will be
        added to the archive with a pathname that begins with the selected directory.
      </p>
      <p class="wrap">
        You can remove selected files from the <span class="component">Input files</span> list
        box with the <span class="command">Remove</span> command (Shift+Delete).
      </p>
      <p class="wrap">
        To allow you to check the pathname that a file will have when it is added to the
        archive, you can toggle the list of files between system pathnames and archive pathnames
        using the <span class="component">System/Archive</span> button to the lower right of the
        <span class="component">Input files</span> list box.  The other kind of pathname is
        displayed as a tooltip when the mouse cursor hovers over the file in the <span
        class="component">Input files</span> list box.
      </p>
      <p class="wrap">
        If you try to add a file that has the same archive pathname as a file that is already in
        the archive, you will be asked whether you want to replace the existing file.  Such a
        conflict may arise even within the set of files in the <span class="component">Input
        files</span> list box because, while each file in the list must have a unique system
        pathname, it is possible to select multiple files that have the same archive pathname.
      </p>

      <h4 id="section7-3-4">7.3.4&nbsp; Extracting files from an archive</h4>
      <p class="wrap">
        The <a class="command" href="#section8-4-3">Archive &gt; Extract files</a> command
        decrypts the selected files and writes them to a specified directory.  When you issue
        the command, a dialog box is displayed in which you can choose the directory to which
        the decrypted files will be written.  Each decrypted file will be written to the chosen
        directory with the pathname that it has in the archive, including any directory
        structure.
      </p>

      <h4 id="section7-3-5">7.3.5&nbsp; Validating files in an archive</h4>
      <p class="wrap">
        The <a class="command" href="#section8-4-4">Archive &gt; Validate files</a> command
        validates the selected files by reading and decrypting them but without writing any
        output.  The command can be used to check the integrity of files in the archive.
      </p>

      <h4 id="section7-3-6">7.3.6&nbsp; Deleting files from an archive</h4>
      <p class="wrap">
        The <a class="command" href="#section8-4-5">Archive &gt; Delete files</a> command
        deletes the selected files from the archive.  Each selected file is deleted in two
        respects: the file&apos;s entry is removed from the archive database and the encrypted
        file is deleted from the file system.  Unless you are deleting an entire archive, it is
        recommended that you use this command to delete files from an archive rather than
        deleting the files directly from the file system.
      </p>

      <h3 id="section7-4">7.4&nbsp; Concealing data in an image</h3>

      <p class="wrap">
        The practice of concealing data in an image is an example of <a class="external"
        href="https://en.wikipedia.org/wiki/Steganography">steganography</a>.  In Qana, a
        general file or the content of a text document can be encrypted and concealed in an
        image file in a single operation.
      </p>
      <p class="wrap">
        The operation to conceal data in an image has two inputs, a <i>payload</i> and a
        <i>carrier</i>, from which a single output file is generated:
      </p>
      <ul class="list">
        <li class="wrap">
          The <i>payload</i> is the plaintext that is to be concealed.  It is encrypted before
          it is concealed.
        </li>
        <li class="wrap">
          The <i>carrier</i> is the image in which the encrypted payload is to be concealed.
          The image may be read from a specified file or it may be automatically generated by
          Qana.
        </li>
        <li class="wrap">
          The <i>output file</i> is a PNG-format image containing the concealed data.
        </li>
      </ul>

      <p class="wrap">
        Within Qana, a carrier image is represented by an <a class="external"
        href="https://en.wikipedia.org/wiki/RGB_color_model">RGB colour model</a> in which a
        pixel consists of three colour components, R(ed), G(reen) and B(lue), each of which is
        an 8-bit value.  The encrypted payload is concealed in the image by replacing some
        low-order bits of the RGB components with bits of the payload.  The replacements are
        spread evenly throughout the image.  If the carrier is an image file, the maximum number
        of low-order bits that will be replaced by the payload is selectable, between one and
        four; if the carrier is autogenerated, the maximum is fixed at two bits.  The more bits
        of the RGB components that are replaced by the payload, the greater is the visible
        difference between the input (carrier) and output images.
      </p>
      <p class="wrap">
        If the carrier is an image file, the dimensions of the image in pixels and the maximum
        number of replacement bits per RGB component will determine the maximum size of the
        payload that can be concealed in the carrier.
      </p>
      <p class="wrap">
        An autogenerated carrier image has an aspect ratio of 4:3, and both of the dimensions
        are divisble by 16.  The minimum dimensions of an image are 128 &times; 96 pixels.
        Within these constraints, the dimensions of an autogenerated image are calculated to
        accommodate the encrypted payload in no more than two low-order bits of each RGB
        component.  The two low-order bits of all RGB components of an autogenerated image are
        randomised to give a uniform level of noise throughout the image.
      </p>
      <p class="wrap">
        Autogenerated carrier images have a generic form consisting of overlaid polygons.  The
        edges of the polygons may be linear or one of two kinds of cubic curve according to the
        value of the <a class="configProperty"
        href="#cp-general-carrierImageKind">general.carrierImageKind</a> configuration property.
      </p>
      <p class="wrap">
        For steganography to be successful, the existence of concealed data should not be
        suspected by an adversary.  In this respect, the form of concealment offered by Qana has
        two significant weaknesses:
      </p>
      <ol class="list">
        <li class="spaced wrap">
          The PNG format is chosen as the format for the output file because it supports
          lossless compression, which is necessary to preserve the modified low-order bits of
          the RGB components of the image.  The presence of concealed data as noise reduces the
          amount by which the image data can be compressed, resulting in a relatively large PNG
          file.  A large PNG file &mdash; or merely the use of the PNG format rather than the
          more common JPEG &mdash; may alert an adversary to the possible presence of concealed
          data.  <a class="external"
          href="https://en.wikipedia.org/wiki/Portable_Network_Graphics#Optimizing_tools">Tools</a>
          for reducing the size of PNG files are available.
        </li>
        <li class="spaced wrap">
          Qana&apos;s autogenerated carrier images have a characteristic form that reveals their
          use as a container for concealed data, greatly diminishing their steganographic value.
          This effect may be attenuated by mixing images concealing ciphertext with images that
          are generated by the <a class="command" href="#section8-6-7">Encryption &gt; Generate
          garbage</a> command in the expectation that the latter will provide plausible
          deniability for the former.  However, such deniability could be achieved without
          concealing data in an image (ie, by mixing ciphertext with garbage in the form of
          ciphertext).
        </li>
      </ol>

      <h4 id="section7-4-1">7.4.1&nbsp; Concealing a file</h4>
      <p class="wrap">
        You can conceal a file in an image with the <a class="command"
        href="#section8-1-11">File &gt; Conceal file in image</a> command, which brings up a
        dialog in which you can select the input files, output file and some additional
        parameters of the concealment operation.
      </p>
      <p class="wrap">
        The <span class="component">Payload file</span> field specifies the plaintext file that
        is to be encrypted and concealed.
      </p>
      <p class="wrap">
        The <span class="component">Carrier file</span> and <span
        class="component">Autogenerated carrier</span> radio buttons select the kind of carrier
        &mdash; the image in which the encrypted payload is to be concealed.  If the <span
        class="component">Carrier file</span> button is selected, the adjacent field specifies
        the file; otherwise, the image is automatically generated.
      </p>
      <p class="wrap">
        The <span class="component">Output file</span> field specifes the image file that will
        contain the concealed data.
      </p>
      <p class="wrap">
        If you choose a carrier file rather than an autogenerated carrier, the three components
        at the bottom of the dialog will be enabled:
      </p>
      <p class="wrap">
        The <span class="component">Maximum number of bits</span> drop-down list allows you to
        select the maximum number of low-order bits of the RGB components of the image that will
        be replaced by the payload.
      </p>
      <p class="wrap">
        If the <span class="component">Set timestamp</span> check box is enabled, the timestamp
        of the output file will be set to the timestamp of the carrier file.
      </p>
      <p class="wrap">
        If the <span class="component">Add random bits</span> check box is enabled, all the
        low-order bits of RGB components of the image that are not replaced by bits from the
        payload will be randomised.  (The number of bits of each RGB component that will be
        randomised is the the value that is selected from the <span class="component">Maximum
        number of bits</span> drop-down list).  The purpose of the randomisation is to disguise
        the presence of the payload by adding noise uniformly to all the pixels of an image, as
        though <a class="external" href="https://en.wikipedia.org/wiki/Dither">dither</a> had
        been applied.
      </p>
      <p class="wrap">
        The format of the carrier file is restricted to the image formats that are supported by
        the particular Java runtime environment, which will typically include GIF, JPEG, and PNG
        formats.  An error message will be displayed if the format of the carrier file is not
        supported.
      </p>
      <p class="wrap">
        If the <span class="component">Conceal file</span> dialog is accepted with the <span
        class="command">Conceal</span> command and there is no <a href="#section8-6-3">automatic
        use</a> of a <a href="#section4-3-2">global key</a>, a <a
        href="#section6-2">key-selection dialog</a> will be displayed for you to select the key
        that will be used to encrypt the payload.
      </p>

      <h4 id="section7-4-2">7.4.2&nbsp; Recovering a concealed file</h4>
      <p class="wrap">
        A file that has been concealed in an image can be recovered with the <a class="command"
        href="#section8-1-12">File &gt; Recover file from image</a> command, which brings up a
        dialog in which you can select the input file and output file.
      </p>
      <p class="wrap">
        If the <span class="component">Recover file</span> dialog is accepted with the <span
        class="command">Recover</span> command and there is no <a href="#section8-6-3">automatic
        use</a> of a <a href="#section4-3-2">global key</a>, a <a
        href="#section6-2">key-selection dialog</a> will be displayed for you to select the key
        that will be used to decrypt the concealed ciphertext.
      </p>

      <h4 id="section7-4-3">7.4.3&nbsp; Concealing text</h4>
      <p class="wrap">
        You can conceal the content of a text document in an image with the <a class="command"
        href="#section8-5-5">Text &gt; Conceal text in image</a> command, which brings up a
        dialog similar to the one that is displayed for <a href="#section7-4-1">concealing a
        file</a> except that there is no <span class="component">Payload file</span> field since
        the payload is implicit.
      </p>
      <p class="wrap">
        If the <span class="component">Conceal text</span> dialog is accepted with the <span
        class="command">Conceal</span> command and there is no <a href="#section8-6-3">automatic
        use</a> of a <a href="#section4-3-2">global key</a>, a <a
        href="#section6-2">key-selection dialog</a> will be displayed for you to select the key
        that will be used to encrypt the text.
      </p>

      <h4 id="section7-4-4">7.4.4&nbsp; Recovering concealed text</h4>
      <p class="wrap">
        Text that has been concealed in an image can be recovered with the <a class="command"
        href="#section8-5-6">Text &gt; Recover text from image</a> command, which brings up a
        dialog in which you can select the input file.
      </p>
      <p class="wrap">
        If the <span class="component">Recover text</span> dialog is accepted with the <span
        class="command">Recover</span> command, a new text document will be created for the
        recovered text.  If there is no <a href="#section8-6-3">automatic use</a> of a <a
        href="#section4-3-2">global key</a>, a <a href="#section6-2">key-selection dialog</a>
        will be displayed for you to select the key that will be used to decrypt the concealed
        ciphertext.
      </p>

      <h3 id="section7-5">7.5&nbsp; Splitting and recombining a file</h3>

      <p class="wrap">
        Qana provides a facility for splitting a large file into a set of smaller, encrypted
        files for secure storage or transmission, and for recombining the set of files into the
        original file.  The files that result from the splitting operation are referred to as
        <i>file parts</i>.  Each file part is encrypted with the same user key but a different
        content-encryption key and written to a specified directory with a generic filename.
        The name of each file part is a unique string of 40 randomly generated hexadecimal-digit
        characters that must not be changed or the set of file parts will be inconsistent.  The
        timestamp of each file part is set to that of the original file.
      </p>
      <p class="wrap">
        When a file is split, the lengths of the sections into which it is divided are randomly
        selected from a specified range.  The lengths of the output files (ie, the file parts)
        cannot be controlled directly because the plaintext is compressed before encryption.
      </p>
      <p class="wrap">
        When file parts are recombined, they must all be in the same directory.  If the
        directory contains additional files that have the generic name of a file part (40
        hexadecimal-digit characters), you must be able to identify the set of file parts that
        you want to recombine by the name of its first file, the number of its parts or its
        timestamp.
      </p>

      <h4 id="section7-5-1">7.5.1&nbsp; Splitting a file</h4>
      <p class="wrap">
        You can split a file with the <a class="command" href="#section8-1-13">File &gt; Split
        file</a> command, which brings up a <span class="component">Split file</span> dialog.
      </p>
      <p class="wrap">
        The <span class="component">Input file</span> field specifies the file that will be
        split.
      </p>
      <p class="wrap">
        The <span class="component">Output directory</span> field specifies the directory to
        which the file parts will be written.
      </p>
      <p class="wrap">
        The output directory should not already contain any files that have the generic name of
        a file part unless, when you come to recombine the parts, you are able to select the set
        of file parts by the name of its first file, the number of its parts or its timestamp.
        If the output directory already contains files that have the generic name of a file
        part, you will be asked whether you want to delete them before the file is split.
      </p>
      <p class="wrap">
        The <span class="component">File-part length</span> spinners specify the lower and upper
        bounds of the lengths of the sections into which the input file is divided.  The button
        to the right of each spinner cycles through the following units of the spinner&apos;s
        value:
      </p>

      <table class="basic" id="defByteUnits">
        <tr>
          <td class="definitionTerm">B</td>
          <td>bytes</td>
          <td>&nbsp;</td>
        </tr>
        <tr>
          <td class="definitionTerm">KiB</td>
          <td>kibibytes</td>
          <td>1 KiB = 2<sup>10</sup> bytes = 1024 bytes</td>
        </tr>
        <tr>
          <td class="definitionTerm">MiB</td>
          <td>mebibytes</td>
          <td>1 MiB = 2<sup>20</sup> bytes = 1048576 bytes</td>
        </tr>
      </table>

      <p class="wrap">
        To the right of the <span class="component">File-part length</span> spinners is a button
        that links and unlinks the lower and upper bounds of the length range.  When the bounds
        are linked, changing the value of one bound automatically changes the value of the other
        bound; when the bounds are unlinked, they can be changed independently of one another.
      </p>
      <p class="wrap">
        If the <span class="component">Split file</span> dialog is accepted with the <span
        class="command">Split</span> command and there is no <a href="#section8-6-3">automatic
        use</a> of a <a href="#section4-3-2">global key</a>, a <a
        href="#section6-2">key-selection dialog</a> will be displayed for you to select the key
        that will be used to encrypt the file parts.
      </p>

      <h4 id="section7-5-2">7.5.2&nbsp; Recombining a split file</h4>
      <p class="wrap">
        You can recombine the parts of a split file with the <a class="command"
        href="#section8-1-14">File &gt; Join files</a> command, which brings up a <span
        class="component">Join file</span> dialog.
      </p>
      <p class="wrap">
        The <span class="component">Input directory</span> field specifies the directory in
        which the file parts are located.  All the file parts must be in this directory.
      </p>
      <p class="wrap">
        The <span class="component">Output file</span> field specifies the file that will be
        created by joining the input file parts together.
      </p>
      <p class="wrap">
        If the <span class="component">Join files</span> dialog is accepted with the <span
        class="command">Join</span> command and there is no <a href="#section8-6-3">automatic
        use</a> of a <a href="#section4-3-2">global key</a>, a <a
        href="#section6-2">key-selection dialog</a> will be displayed for you to select the key
        that will be used to decrypt the file parts.  If the input directory contains more than
        one set of file parts, a further dialog is displayed for you to select the set of file
        parts that you wish to recombine.  The dialog contains a list of the available sets,
        each of which has three fields: the filename of the first file part of the set, the
        number of file parts in the set, and the timestamp of the first file part.
      </p>

    </div>

    <!--=====================================================================================-->

    <!-- Commands -->

    <div class="section">
      <h2 id="section8">8&nbsp; Commands</h2>
      <p class="tocLink">
        [ <a href="#toc">Table of contents</a> ]
      </p>

      <p class="wrap">
        Qana&apos;s main commands are accessible from its main menu.  Some of the commands are
        also accessible from context menus that are activated in a system-dependent manner (eg,
        by pressing or releasing the right mouse button) while the mouse cursor is over the main
        window.
      </p>
      <p class="wrap">
        The items in the <span class="component">Edit</span> menu differ according to whether
        the current document is an archive document or a text document.
      </p>

      <h3 id="section8-1">8.1&nbsp; <span class="component">File</span> menu</h3>

      <h4 id="section8-1-1">8.1.1&nbsp; <span class="command">New archive</span></h4>
      <p class="wrap">
        The <span class="command">New archive</span> command (Ctrl+N) creates a new <a
        href="#section5-1">archive document</a>.
      </p>
      <p class="wrap">
        The command is disabled if the maximum number of documents are open in the application.
      </p>

      <h4 id="section8-1-2">8.1.2&nbsp; <span class="command">Open archive</span></h4>
      <p class="wrap">
        The <span class="command">Open archive</span> command (Ctrl+O) brings up a
        file-selection dialog in which you can choose the <a href="#section5-1">archive
        document</a> that you want to open.
      </p>
      <p class="wrap">
        The command is disabled if the maximum number of documents are open in the application.
      </p>

      <h4 id="section8-1-3">8.1.3&nbsp; <span class="command">Revert archive</span></h4>
      <p class="wrap">
        The <span class="command">Revert archive</span> command reads the current archive
        document again from the file system, replacing the modified document in Qana.  Any
        changes that you have made to the current document will be lost.
      </p>
      <p class="wrap">
        The command is disabled if the current document has not changed from when it was last
        opened or saved.
      </p>

      <h4 id="section8-1-4">8.1.4&nbsp; <span class="command">Close document</span></h4>
      <p class="wrap">
        The <span class="command">Close document</span> command (Ctrl+W) closes the current
        document.  If the document is an archive document and has unsaved changes, you will be
        prompted to save the document before it is closed.  If the document is a non-empty text
        document, you will be asked to confirm its closure.
      </p>

      <h4 id="section8-1-5">8.1.5&nbsp; <span class="command">Close all documents</span></h4>
      <p class="wrap">
        The <span class="command">Close all documents</span> command closes all open documents.
        You will be prompted to save any archive documents that have unsaved changes and asked
        to confirm the closure of any non-empty text documents.
      </p>

      <h4 id="section8-1-6">8.1.6&nbsp; <span class="command">Save archive</span></h4>
      <p class="wrap">
        The <span class="command">Save archive</span> command (Ctrl+S) writes the current
        archive document to a file.  If the document has no key (eg, because it is a new
        document or its key has been cleared) and there is no <a href="#section8-6-3">automatic
        use</a> of a <a href="#section4-3-2">global key</a>, a key-selection dialog will be
        displayed.
      </p>
      <p class="wrap">
        The command is disabled if the current document has not changed from when it was last
        opened or saved.
      </p>

      <h4 id="section8-1-7">8.1.7&nbsp; <span class="command">Save archive as</span></h4>
      <p class="wrap">
        The <span class="command">Save archive as</span> command writes the current archive
        document to a file.  The command brings up a file-selection dialog in which you can
        select the pathname of the file to which the document will be written.  A warning is
        displayed if the selected file already exists.  If the document has no key (eg, because
        it is a new document or its key has been cleared) and there is no <a
        href="#section8-6-3">automatic use</a> of a <a href="#section4-3-2">global key</a>, a <a
        href="#section6-2">key-selection dialog</a> will be displayed for you to select the key
        that will be used to encrypt the archive database.
      </p>
      <p class="wrap">
        After the archive document is written to the selected file, the document&apos;s archive
        directory will be set to the parent directory of the file.  If this is different from
        the original archive directory, the database and contents of the archive will be
        inconsistent unless the contents have been copied or moved to the new directory.
      </p>

      <h4 id="section8-1-8">8.1.8&nbsp; <span class="command">Encrypt file</span></h4>
      <p class="wrap">
        The <span class="command">Encrypt file</span> command encrypts a general file.  If the
        <a class="configProperty"
        href="#cp-file-selectEncryptDecryptOutputFile">file.selectEncryptDecryptOutputFile.menuCommand</a>
        configuration property is <code>true</code>, an <span class="component">Encrypt
        file</span> dialog is displayed in which the input file and output file can be selected;
        otherwise, a file-selection dialog is displayed for selecting the input file, and the
        output file will have the default pathname, described below.  The output file will also
        have the default pathname if the <span class="component">Output file</span> field of the
        <span class="component">Encrypt file</span> dialog is empty.
      </p>
      <p class="wrap">
        The default output pathname is the pathname of the input file with the filename suffix
        specified by the <a class="configProperty"
        href="#cp-file-filenameSuffix-encrypted">file.filenameSuffix.encrypted</a> configuration
        property appended to it.  The default filename suffix is <code>.qana</code> .
      </p>
      <p class="wrap">
        If there is no <a href="#section8-6-3">automatic use</a> of a <a
        href="#section4-3-2">global key</a>, a <a href="#section6-2">key-selection dialog</a>
        will be displayed for you to select the key that will be used to encrypt the file.
      </p>

      <h4 id="section8-1-9">8.1.9&nbsp; <span class="command">Decrypt file</span></h4>
      <p class="wrap">
        The <span class="command">Decrypt file</span> command decrypts a file that was encrypted
        with the <a class="command" href="#section8-1-8">Encrypt file</a> command.  If the <a
        class="configProperty"
        href="#cp-file-selectEncryptDecryptOutputFile">file.selectEncryptDecryptOutputFile.menuCommand</a>
        configuration property is <code>true</code>, an <span class="component">Decrypt
        file</span> dialog is displayed in which the input file and output file can be selected;
        otherwise, a file-selection dialog is displayed for selecting the input file, and the
        output file will have the default pathname, described below.  The output file will also
        have the default pathname if the <span class="component">Output file</span> field of the
        <span class="component">Decrypt file</span> dialog is empty.
      </p>
      <p class="wrap">
        If the name of the input file has the suffix specified by the <a class="configProperty"
        href="#cp-file-filenameSuffix-encrypted">file.filenameSuffix.encrypted</a> configuration
        property (<code>.qana</code> by default), the default output pathname will be the input
        pathname with the filename suffix removed; otherwise, it will be the input pathname with
        a numerical suffix appended to the filename stem.
      </p>
      <p class="wrap">
        If there is no <a href="#section8-6-3">automatic use</a> of a <a
        href="#section4-3-2">global key</a>, a <a href="#section6-2">key-selection dialog</a>
        will be displayed for you to select the key that will be used to decrypt the file.
      </p>

      <h4 id="section8-1-10">8.1.10&nbsp; <span class="command">Validate file</span></h4>
      <p class="wrap">
        The <span class="command">Validate file</span> command decrypts a file but without
        writing the plaintext to an output file.  It can be used to check that a file was
        encrypted with a particular key or to check the integrity of an encrypted file.  A
        file-selection dialog will be displayed for selecting the file that is to be validated,
        and, if there is no <a href="#section8-6-3">automatic use</a> of a <a
        href="#section4-3-2">global key</a>, a <a href="#section6-2">key-selection dialog</a>
        will be displayed for you to select the key that will be used to decrypt the file.  If
        the file is successfully validated, a message is displayed to that effect; otherwise, an
        error message is displayed.
      </p>

      <h4 id="section8-1-11">8.1.11&nbsp; <span class="command">Conceal file in image</span></h4>
      <p class="wrap">
        The <span class="command">Conceal file in image</span> command encrypts a file and
        conceals it in an image &mdash; either a specified image file or an automatically
        generated image.  More information can be found elsewhere in the manual on the general
        subject of <a href="#section7-4">concealing data in an image</a> and on the specific
        operation of <a href="#section7-4-1">concealing a file</a>.
      </p>

      <h4 id="section8-1-12">8.1.12&nbsp; <span class="command">Recover file from image</span></h4>
      <p class="wrap">
        The <span class="command">Recover file from image</span> command extracts and decrypts a
        file that was concealed in an image with the <a class="command"
        href="#section8-1-11">File &gt; Conceal file in image</a> command.  More information can
        be found elsewhere in the manual on the general subject of <a
        href="#section7-4">concealing data in an image</a> and on the specific operation of <a
        href="#section7-4-2">recovering a concealed file</a>.
      </p>

      <h4 id="section8-1-13">8.1.13&nbsp; <span class="command">Split file</span></h4>
      <p class="wrap">
        The <span class="command">Split file</span> command splits a file into a set of
        encrypted files.  More information can be found elsewhere in the manual on the general
        subject of <a href="#section7-5">splitting and recombining a file</a> and on the
        specific operation of <a href="#section7-5-1">splitting a file</a>.
      </p>

      <h4 id="section8-1-14">8.1.14&nbsp; <span class="command">Join files</span></h4>
      <p class="wrap">
        The <span class="command">Join files</span> command recombines into a single file a set
        of encrypted files that were split with the <a class="command"
        href="#section8-1-13">File &gt; Split file</a> command.  More information can be found
        elsewhere in the manual on the general subject of <a href="#section7-5">splitting and
        recombining a file</a> and on the specific operation of <a
        href="#section7-5-2">recombining a split file</a>.
      </p>

      <h4 id="section8-1-15">8.1.15&nbsp; <span class="command">Erase files</span></h4>
      <p class="wrap">
        The <span class="command">Erase files</span> command (Ctrl+Shift+X) erases files by
        overwriting them with random data and renaming them with a long random filename before
        removing them from the file system.  The number of times that a file is overwritten is
        specified by the <a class="configProperty"
        href="#cp-file-erasureNumPasses">file.erasureNumPasses</a> configuration property.
      </p>
      <p class="wrap">
        The erasure of files by overwriting may not be possible in some cases (for example, on
        copy-on-write file systems such as ZFS).  Before relying on the <span
        class="command">Erase files</span> command, it is recommended that you read about <a
        class="external" href="https://en.wikipedia.org/wiki/Data_erasure">data erasure</a> and
        the <a class="external" href="https://en.wikipedia.org/wiki/Data_remanence">problems
        associated with it</a>.
      </p>
      <p class="wrap">
        When you issue the <span class="command">Erase files</span> command, a dialog is
        displayed in which you can select the files and directories that you want to erase.
        Within the dialog, the files and directories that will be erased are shown in the list
        box.  You can add a file or directory to the list with the <span
        class="command">Add</span> command, or you can use drag-and-drop or copy-and-paste to
        transfer multiple files or directories from a file manager.  You can remove an item from
        the list with the <span class="command">Remove</span> command (Shift+Delete).  If you
        select a directory, the directory itself and all of its contents will be added to the
        list.  A directory will be erased only if it is empty; that is, if it is already empty
        or all of its contents are erased too.
      </p>

      <h4 id="section8-1-16">8.1.16&nbsp; <span class="command">Exit</span></h4>
      <p class="wrap">
        The <span class="command">Exit</span> command terminates the application.  Before the
        program shuts down, you will be prompted to save any open archive documents that have
        unsaved changes.
      </p>

      <h3 id="section8-2">8.2&nbsp; <span class="component">Edit</span> menu, archive document</h3>

      <h4 id="section8-2-1">8.2.1&nbsp; <span class="command">Select all</span></h4>
      <p class="wrap">
        The <span class="command">Select all</span> command (Ctrl+A) selects all the files in
        the current archive.
      </p>

      <h4 id="section8-2-2">8.2.2&nbsp; <span class="command">Invert selection</span></h4>
      <p class="wrap">
        The <span class="command">Invert selection</span> command inverts the selection of files
        in the current archive: files that are selected will be unselected and those that are
        not selected will be selected.
      </p>

      <h3 id="section8-3">8.3&nbsp; <span class="component">Edit</span> menu, text document</h3>

      <h4 id="section8-3-1">8.3.1&nbsp; <span class="command">Undo</span>/<span class="command">Redo</span></h4>
      <p class="wrap">
        The edits that you make to a text document can be undone and redone with the
        complementary <span class="command">Undo</span> and <span class="command">Redo</span>
        commands (Ctrl+Z and Ctrl+Y respectively).  The edits to a document are stored in a list
        whose length is limited by the <a class="configProperty"
        href="#cp-general-maxEditListLength">general.maxEditListLength</a> configuration
        property.
      </p>
      <p class="wrap">
        The <span class="command">Undo</span> command reverses the last change to the current
        document.  If an edit is undone with the <span class="command">Undo</span> command, it
        can subsequently be restored with the <span class="command">Redo</span> command provided
        that no other edits have been made since it was undone.
      </p>

      <h4 id="section8-3-2">8.3.2&nbsp; <span class="command">Clear edit history</span></h4>
      <p class="wrap">
        The <span class="command">Clear edit history</span> command clears the history of edits
        to the current text document.  The command may be used to make more memory available if
        a &quot;Not enough memory&quot; error occurs.
      </p>

      <h4 id="section8-3-3">8.3.3&nbsp; <span class="command">Cut</span>, <span class="command">Copy</span>
                             and <span class="command">Paste</span></h4>
      <p class="wrap">
        These commands behave in the standard way: the <span class="command">Cut</span> and
        <span class="command">Copy</span> commands both copy the selected text from the current
        document to the system clipboard, and the <span class="command">Cut</span> command then
        deletes the selected text.  The <span class="command">Paste</span> command inserts text
        from the system clipboard into the current document at the caret (text cursor).
      </p>

      <h4 id="section8-3-4">8.3.4&nbsp; <span class="command">Copy all</span></h4>
      <p class="wrap">
        The <span class="command">Copy all</span> command (Ctrl+Shift+C) copies the entire
        contents of the current document to the system clipboard.
      </p>

      <h4 id="section8-3-5">8.3.5&nbsp; <span class="command">Paste all</span></h4>
      <p class="wrap">
        The <span class="command">Paste all</span> command (Ctrl+Shift+V) replaces the entire
        contents of the current document with text from the system clipboard.
      </p>

      <h4 id="section8-3-6">8.3.6&nbsp; <span class="command">Clear</span></h4>
      <p class="noBottomMargin wrap">
        The <span class="command">Clear</span> command (Ctrl+Shift+Delete) deletes the entire
        contents of the current document.
      </p>

      <h4 id="section8-3-7">8.3.7&nbsp; <span class="command">Select all</span></h4>
      <p class="wrap">
        The <span class="command">Select all</span> command (Ctrl+A) selects all the text in the
        current document.
      </p>

      <h4 id="section8-3-8">8.3.8&nbsp; <span class="command">Wrap text</span></h4>
      <p class="noBottomMargin wrap">
        The selected text within a text document can be processed with a word-wrapping algorithm
        that performs two operations on the text:
      </p>
      <ol class="continuationList">
        <li class="wrap">
          it optionally adjusts the number of spaces between sentences, and
        </li>
        <li class="wrap">
          it adjusts the line breaks within a paragraph so that each line of text is indented by
          a specified number of spaces and does not exceed a specified length unless the line
          contains no spaces.
        </li>
      </ol>
      <p class="wrap">
        For the first operation, the end of a sentence is defined by an end-of-sentence pattern,
        a <a class="external" href="https://en.wikipedia.org/wiki/Regular_expression">regular
        expression</a> that is specified by the <a class="configProperty"
        href="#cp-text-wrap-endOfSentencePattern">text.wrap.endOfSentencePattern</a>
        configuration property.  If the end-of-sentence pattern is empty, no operation is
        performed.  If the pattern is not empty, it is implicitly extended by one or more
        spaces, and the text is searched for the extended pattern.  For each match of the
        extended pattern, the spaces that follow the end of a sentence are replaced by the
        number of spaces specified by <a class="configProperty"
        href="#cp-text-wrap-numSpacesBetweenSentences">text.wrap.numSpacesBetweenSentences</a>
        configuration property.
      </p>
      <p class="wrap">
        For the second operation, the text is deemed to be composed of one or more paragraphs,
        where successive paragraphs are blocks of text that are separated by two consecutive
        line ends (ie, a line end followed by a blank line).  The text within a paragraph is
        deemed to be composed of words, where a word is one or more consecutive non-space
        characters, and words are separated by one or more spaces.  For each paragraph, the
        wrapping algorithm tries to fit as many words as possible on a line, up to a specified
        line length and breaking a line only between words.
      </p>
      <p class="wrap">
        The <span class="command">Wrap text</span> command (Ctrl+R) brings up a dialog in which
        you can specify the line length and indent that will be applied by the word-wrapping
        algorithm.
      </p>
      <p class="wrap">
        The line length is specified in the <span class="component">Line length</span> combo box
        of the <span class="component">Wrap text</span> dialog.  The value of the line length
        that initially appears in the combo box is specified by the <a class="configProperty"
        href="#cp-text-wrap-defaultLineLength">text.wrap.defaultLineLength</a> configuration
        property.  If the <span class="component">Line length</span> combo box is empty or the
        line length is zero, each paragraph of the text is <i>unwrapped</i> onto a single line.
      </p>
      <p class="noBottomMargin wrap">
        Each line of wrapped text may be indented by a number of spaces, as specified in the
        <span class="component">Indent</span> combo box of the <span class="component">Wrap
        text</span> dialog.  The indent specifier consists of either a single argument or two
        arguments, separated by a comma:
      </p>
      <ul class="continuationList">
        <li class="wrap">
          If the indent specifier has only one argument, it applies to all the lines in a
          paragraph.
        </li>
        <li class="wrap">
          If the indent specifier has two arguments, the first argument applies to the first
          line of the paragraph, and the second argument applies to the remaining lines.
        </li>
      </ul>
      <p class="wrap">
        The arguments may be either absolute or relative values; a relative value is either (a)
        the current indent of the first line of the paragraph with an optional offset, or (b)
        for the second argument, the indent of the first line of the paragraph after the first
        argument is applied, with an offset.
      </p>
      <p class="wrap">
        The following tables describe the arguments of an indent specifier:
      </p>

      <table class="dataStructure">
        <tr>
          <th colspan="2">First argument</th>
        </tr>
        <tr>
          <td class="subheader wrap" colspan="2">
            <span class="variable">n</span> denotes a decimal number between 0 and 999
            inclusive, and [<span class="literal">+</span>|<span class="literal">&minus;</span>]
            denotes either a <i>plus</i> or <i>minus</i> character.
          </td>
        </tr>
        <tr>
          <td class="key"><span class="variable">n</span></td>
          <td class="description">Absolute indent</td>
        </tr>
        <tr>
          <td class="key"><span class="literal">$</span></td>
          <td class="description">The current indent of the first line</td>
        </tr>
        <tr>
          <td class="key wrap">
            <span class="literal">$</span>[<span class="literal">+</span>|<span
            class="literal">&minus;</span>]<span class="variable">n</span>
          </td>
          <td class="description">Relative to the current indent of the first line</td>
        </tr>
      </table>

      <table class="dataStructure">
        <tr>
          <th colspan="2">Second argument</th>
        </tr>
        <tr>
          <td class="subheader wrap" colspan="2">
            <span class="variable">n</span> denotes a decimal number between 0 and 999
            inclusive, and [<span class="literal">+</span>|<span class="literal">&minus;</span>]
            denotes either a <i>plus</i> or <i>minus</i> character.
          </td>
        </tr>
        <tr>
          <td class="key"><span class="variable">n</span></td>
          <td class="description">Absolute indent</td>
        </tr>
        <tr>
          <td class="key"><span class="literal">$</span></td>
          <td class="description">The current indent of the first line</td>
        </tr>
        <tr>
          <td class="key wrap">
            <span class="literal">$</span>[<span class="literal">+</span>|<span
            class="literal">&minus;</span>]<span class="variable">n</span>
          </td>
          <td class="description">Relative to the current indent of the first line</td>
        </tr>
        <tr>
          <td class="key wrap">
            [<span class="literal">+</span>|<span class="literal">&minus;</span>]<span
            class="variable">n</span>
          </td>
          <td class="description wrap">
            Relative to the indent of the first line after the first argument is applied
          </td>
        </tr>
      </table>

      <p class="wrap">
        If the <span class="component">Wrap text</span> dialog is accepted with the <span
        class="command">Wrap text</span> command, the two operations described above are
        performed on the selected text, which is replaced by the processed text.
      </p>

      <h3 id="section8-4">8.4&nbsp; <span class="component">Archive</span> menu</h3>

      <h4 id="section8-4-1">8.4.1&nbsp; <span class="command">Choose archive directory</span></h4>
      <p class="wrap">
        The <span class="command">Choose archive directory</span> command (Ctrl+Alt+D) brings up
        a file-selection dialog in which you can choose the directory of the current archive.
        More information can be found elsewhere in the manual on the general subject of <a
        href="#section7-3">managing an archive</a>.
      </p>
      <p class="wrap">
        The command is disabled if the current archive is not empty.
      </p>

      <h4 id="section8-4-2">8.4.2&nbsp; <span class="command">Add files</span></h4>
      <p class="wrap">
        The <span class="command">Add files</span> command (F5) brings up a dialog in which you
        can select files to add to the current archive.  More information can be found elsewhere
        in the manual on the general subject of <a href="#section7-3">managing an archive</a>
        and on the specific operation of <a href="#section7-3-3">adding files to an archive</a>.
      </p>
      <p class="wrap">
        The command is disabled if the archive directory has not been set for the current
        archive.
      </p>

      <h4 id="section8-4-3">8.4.3&nbsp; <span class="command">Extract files</span></h4>
      <p class="wrap">
        The <span class="command">Extract files</span> command (F8) brings up a dialog in which
        you can select an output directory.  If the dialog is accepted, the files that are
        selected in the current archive are decrypted and written to the specified directory.
        More information can be found elsewhere in the manual on the general subject of <a
        href="#section7-3">managing an archive</a> and on the specific operation of <a
        href="#section7-3-4">extracting files from an archive</a>.
      </p>
      <p class="wrap">
        The command is disabled if no files are selected in the current archive view.
      </p>

      <h4 id="section8-4-4">8.4.4&nbsp; <span class="command">Validate files</span></h4>
      <p class="wrap">
        The <span class="command">Validate files</span> command validates the selected files in
        an archive by decrypting them without writing the decrypted files.  More information can
        be found elsewhere in the manual on the general subject of <a
        href="#section7-3">managing an archive</a> and on the specific operation of <a
        href="#section7-3-5">validating files in an archive</a>.
      </p>
      <p class="wrap">
        The command is disabled if no files are selected in the current archive view.
      </p>

      <h4 id="section8-4-5">8.4.5&nbsp; <span class="command">Delete files</span></h4>
      <p class="wrap">
        The <span class="command">Delete files</span> command (Ctrl+Shift+Delete) deletes the
        selected files from an archive.  More information can be found elsewhere in the manual
        on the general subject of <a href="#section7-3">managing an archive</a> and on the
        specific operation of <a href="#section7-3-6">deleting files from an archive</a>.
      </p>
      <p class="wrap">
        The command is disabled if no files are selected in the current archive view.
      </p>

      <h4 id="section8-4-6">8.4.6&nbsp; <span class="command">Display list of files</span></h4>
      <p class="wrap">
        The <span class="command">Display list of files</span> command (Ctrl+Alt+L) brings up a
        dialog in which a list of the selected files is displayed.  The items in the list are
        the archive pathnames of the files.  The list can be copied to the system clipboard.
      </p>
      <p class="wrap">
        The command is disabled if no files are selected in the current archive view.
      </p>

      <h4 id="section8-4-7">8.4.7&nbsp; <span class="command">Display map of files</span></h4>
      <p class="wrap">
        The <span class="command">Display map of files</span> command (Ctrl+Alt+M) brings up a
        dialog in which a map of the selected files is displayed.  The map entry for each file
        consists of its archive pathname and its hash value (the name of the encrypted file in
        the archive directory), separated by a tab character (U+0009).  The map can be copied to
        the system clipboard.
      </p>
      <p class="wrap">
        The command is disabled if no files are selected in the current archive view.
      </p>

      <h4 id="section8-4-8">8.4.8&nbsp; <span class="command">Set key</span></h4>
      <p class="wrap">
        The <span class="command">Set key</span> command (Ctrl+K) brings up a <a
        href="#section6-2">key-selection dialog</a> in which you can select the <a
        href="#section4-3-3">document key</a> for the current archive document.
      </p>

      <h4 id="section8-4-9">8.4.9&nbsp; <span class="command">Clear key</span></h4>
      <p class="wrap">
        The <span class="command">Clear key</span> command (Ctrl+Shift+K) clears the <a
        href="#section4-3-3">document key</a> of the current archive document.
      </p>
      <p class="wrap">
        The command is disabled if the current document does not have a document key.
      </p>

      <h3 id="section8-5">8.5&nbsp; <span class="component">Text</span> menu</h3>

      <h4 id="section8-5-1">8.5.1&nbsp; <span class="command">New text</span></h4>
      <p class="wrap">
        The <span class="command">New text</span> command (Ctrl+T) creates a new <a
        href="#section5-2">text document</a>.
      </p>
      <p class="wrap">
        The command is disabled if the maximum number of documents are open in the application.
      </p>

      <h4 id="section8-5-2">8.5.2&nbsp; <span class="command">Encrypt text</span></h4>
      <p class="wrap">
        The <span class="command">Encrypt text</span> command (F5) encrypts the content of the
        current text document and replaces it with the ciphertext.  The ciphertext will be
        wrapped as a simple XML document if the <a class="command" href="#section8-5-4">Text
        &gt; Wrap encrypted text in XML</a> option is selected.  More information can be found
        elsewhere in the manual on the general subject of <a href="#section7-2">encrypting
        text</a>.
      </p>

      <h4 id="section8-5-3">8.5.3&nbsp; <span class="command">Decrypt text</span></h4>
      <p class="wrap">
        The <span class="command">Decrypt text</span> command (F8) decrypts the content of the
        current text document on the assumption that it was encrypted with the <a
        class="command" href="#section8-5-2">Text &gt; Encrypt text</a> command.  If the <a
        class="command" href="#section8-5-4">Text &gt; Wrap encrypted text in XML</a> option is
        selected, the ciphertext is assumed to have an <a href="#section5-2-1">XML wrapper</a>.
        If the text is successfully decrypted, the content of the current document is replaced
        with the plaintext.  More information can be found elsewhere in the manual on the
        general subject of <a href="#section7-2">encrypting text</a>.
      </p>

      <h4 id="section8-5-4">8.5.4&nbsp; <span class="command">Wrap encrypted text in XML</span></h4>
      <p class="noBottomMargin wrap">
        The <span class="command">Wrap encrypted text in XML</span> option (Ctrl+F9) affects
        both the encryption and decryption of text.  It determines
      </p>
      <ul class="continuationList">
        <li class="wrap">
          whether text that is encrypted with the <a class="command" href="#section8-5-2">Text
          &gt; Encrypt text</a> command will be <a href="#section5-2-1">wrapped as an XML
          document</a>, and
        </li>
        <li class="wrap">
          the form in which the <a class="command" href="#section8-5-3">Text &gt; Decrypt
          text</a> command expects to find the ciphertext.
        </li>
      </ul>

      <h4 id="section8-5-5">8.5.5&nbsp; <span class="command">Conceal text in image</span></h4>
      <p class="wrap">
        The <span class="command">Conceal text in image</span> command encrypts the content of
        the current text document and conceals it in an image &mdash; either a specified image
        file or an automatically generated image.  More information can be found elsewhere in
        the manual on the general subject of <a href="#section7-4">concealing data in an
        image</a> and on the specific operation of <a href="#section7-4-3">concealing text</a>.
      </p>

      <h4 id="section8-5-6">8.5.6&nbsp; <span class="command">Recover text from image</span></h4>
      <p class="wrap">
        The <span class="command">Recover text from image</span> command extracts and decrypts
        text that was concealed in an image with the <a class="command"
        href="#section8-5-5">Text &gt; Conceal text in image</a> command.  If the text is
        successfully recovered, a new document will be created for it.  More information can be
        found elsewhere in the manual on the general subject of <a href="#section7-4">concealing
        data in an image</a> and on the specific operation of <a href="#section7-4-4">recovering
        concealed text</a>.
      </p>
      <p class="wrap">
        The command is disabled if the maximum number of documents are open in the application.
      </p>

      <h4 id="section8-5-7">8.5.7&nbsp; <span class="command">Set key</span></h4>
      <p class="wrap">
        The <span class="command">Set key</span> command (Ctrl+K) brings up a <a
        href="#section6-2">key-selection dialog</a> in which you can select the <a
        href="#section4-3-3">document key</a> for the current text document.
      </p>

      <h4 id="section8-5-8">8.5.8&nbsp; <span class="command">Clear key</span></h4>
      <p class="wrap">
        The <span class="command">Clear key</span> command (Ctrl+Shift+K) clears the <a
        href="#section4-3-3">document key</a> of the current text document.
      </p>
      <p class="wrap">
        The command is disabled if the current document does not have a document key.
      </p>

      <h3 id="section8-6">8.6&nbsp; <span class="component">Encryption</span> menu</h3>

      <h4 id="section8-6-1">8.6.1&nbsp; <span class="command">Set global key</span></h4>
      <p class="wrap">
        The <span class="command">Set global key</span> command (Ctrl+G) brings up a <a
        href="#section6-2">key-selection dialog</a> in which you can select the <a
        href="#section4-3-2">global key</a>.  Use of the global key is controlled by the <a
        class="command" href="#section8-6-3">Encryption &gt; Automatically use global key</a>
        option.
      </p>

      <h4 id="section8-6-2">8.6.2&nbsp; <span class="command">Clear global key</span></h4>
      <p class="wrap">
        The <span class="command">Clear global key</span> command (Ctrl+Shift+G) clears the <a
        href="#section4-3-2">global key</a>.
      </p>
      <p class="wrap">
        The command is disabled if no global key has been set.
      </p>

      <h4 id="section8-6-3">8.6.3&nbsp; <span class="command">Automatically use global key</span></h4>
      <p class="wrap">
        The <span class="command">Automatically use global key</span> option (Ctrl+H) controls
        the use of a <a href="#section4-3-2">global key</a>, if one is set.  If this option is
        selected, the global key is used automatically whenever there is a need to specify a
        user key for an encryption or decryption operation, which may be useful when encrypting
        or decrypting multiple files with drag-and-drop.
      </p>

      <h4 id="section8-6-4">8.6.4&nbsp; <span class="command">Default cipher</span></h4>
      <p class="wrap">
        The <span class="command">Default cipher</span> menu item brings up a submenu from which
        you can select the cipher that will be used by default as the base cipher for an
        encryption operation if the selected user key does not have a <a
        href="#section4-2-1">preferred cipher</a>.
      </p>
      <p class="wrap">
        The name of the current default cipher is displayed in a field of the <a
        href="#section6-1-3">status panel</a>, from where it can be changed by clicking on the
        field.
      </p>

      <h4 id="section8-6-5">8.6.5&nbsp; <span class="command">Edit keys</span></h4>
      <p class="wrap">
        The <span class="command">Edit keys</span> command brings up a dialog in which you can
        edit the <a href="#section4-3">user keys</a>.  On the left of the dialog is a list box
        similar to that of a <a href="#section6-2">key-selection dialog</a>: the list contains
        the names of <a href="#defTemporaryKey">temporary keys</a> followed by <a
        href="#defPersistentKey">persistent keys</a>.
      </p>
      <p class="wrap">
        On the right of the dialog are boxes in which the properties of the selected key &mdash;
        the two sets of <a href="#section4-1-1">KDF parameters</a>, the <a
        href="#section4-2-2">allowed ciphers</a> and the <a href="#section4-2-1">preferred
        cipher</a> &mdash; are displayed.
      </p>
      <p class="wrap">
        Also on the right of the dialog is a panel containing a <span
        class="component">Name</span> field and four buttons.  The buttons issue commands for
        editing the keys; a description of their function is shown as a tooltip when the mouse
        cursor hovers over the button.  The <span class="component">Name</span> field is used to
        provide the name of a key for the <span class="command">Add</span> and <span
        class="command">Rename</span> commands.  The name of a <a
        href="#defPersistentKey">persistent key</a> may not contain the <code>$</code>
        character, which is reserved for use in the names of <a
        href="#defTemporaryKey">temporary keys</a>.
      </p>
      <p class="wrap">
        If you issue a command that applies to an existing key, the key must be verified before
        the command can proceed.  If the key has not already been verified, a passphrase dialog
        is displayed when the command is issued.
      </p>
      <p class="wrap">
        The <span class="command">Add</span> command adds a new key to the list.  The name of
        the new key is specified in the <span class="component">Name</span> field.
      </p>
      <p class="wrap">
        The <span class="command">Rename</span> command renames the selected key.  The new name
        of the key is specified in the <span class="component">Name</span> field.  If you rename
        a <a href="#defTemporaryKey">temporary key</a>, it becomes a <a
        href="#defPersistentKey">persistent key</a>.
      </p>
      <p class="wrap">
        The <span class="command">Edit properties</span> command brings up a dialog in which you
        can edit the properties of the selected key (the two sets of <abbr
        title="Key-derivation function">KDF</abbr> parameters, the <a
        href="#section4-2-2">allowed ciphers</a> and the <a href="#section4-2-1">preferred
        cipher</a>).  The <span class="component">KDF properties</span> dialog has a command for
        generating a test key with the selected parameter set and displaying the time taken to
        generate the key.  The <span class="command">Edit properties</span> command can also be
        issued by double-clicking on a key in the list box.
      </p>
      <p class="wrap">
        The <span class="command">Delete</span> command deletes the selected key from the list.
      </p>

      <h4 id="section8-6-6">8.6.6&nbsp; <span class="command">Show entropy metrics</span></h4>
      <p class="wrap">
        The <span class="command">Show entropy metrics</span> command (Ctrl+M) brings up a
        dialog that displays measurements relating to the <a href="#section9">entropy</a>
        accumulator of the Fortuna <abbr title="Pseudo-random number generator">PRNG</abbr>.
        The dialog is described in the section on <a href="#section9-2">entropy metrics</a>.
      </p>

      <h4 id="section8-6-7">8.6.7&nbsp; <span class="command">Generate garbage</span></h4>
      <p class="wrap">
        Qana has a facility for generating garbage: meaningless random data that has the form of
        Qana&apos;s encrypted output &mdash; a file, text or an image.  You can use the garbage
        to confound an adversary by mixing it with genuine ciphertext, which you can attempt to
        pass off as garbage if confronted about your cryptographic activity.  (Indeed, the mere
        ability to generate garbage may be enough to enable you to claim plausibly that some
        ciphertext is garbage.)  Conversely, an attacker that intercepts some pseudo-ciphertext
        may devote resources to trying to decrypt it in the belief that it&apos;s the real
        thing.
      </p>
      <p class="wrap">
        The <span class="command">Generate garbage</span> command brings up a dialog in which
        you can select the form of garbage that you want to generate (file, text or image) and
        the length of the random data.  In the case of the file and image, you will need to
        specify the output file.  You may either specify the length explicitly or choose a range
        from which a random length will be selected with the <span
        class="command">Randomise</span> command.  (The units <i>KiB</i> and <i>MiB</i> that are
        used in the length ranges are described in <a href="#defByteUnits">this table</a>.)
      </p>
      <p class="wrap">
        If text output is selected, a new text document is created and the spurious ciphertext
        is set as its content.  The text is wrapped in XML according to the <a class="command"
        href="#section8-5-4">Text &gt; Wrap encrypted text in XML</a> option.
      </p>
      <p class="wrap">
        The form of an automatically generated image is described in the section on <a
        href="#section7-4">concealing data in an image</a>.
      </p>

      <h3 id="section8-7">8.7&nbsp; <span class="component">Options</span> menu</h3>

      <h4 id="section8-7-1">8.7.1&nbsp; <span class="command">Show full pathnames</span></h4>
      <p class="wrap">
        The <span class="command">Show full pathnames</span> option controls whether the full
        pathname of the current archive document or only its filename is displayed in the title
        bar of the main window.
      </p>

      <h4 id="section8-7-2">8.7.2&nbsp; <span class="command">Manage file associations</span></h4>
      <p class="wrap">
        The <span class="command">Manage file associations</span> command provides, on Windows,
        a means of adding or removing associations between the Qana application and files with
        the filename suffixes of <a class="configProperty"
        href="#cp-file-filenameSuffix-encrypted">Qana-encrypted files</a> and <a
        class="configProperty" href="#cp-file-filenameSuffix-archive">Qana archives</a>.  A file
        association will allow you, for example, to open an archive in Qana by double-clicking
        on its filename in Windows Explorer.  If Qana is already running, the file will be
        opened in it; otherwise, the file will be opened in a new instance of Qana.
      </p>
      <p class="wrap">
        The command creates file associations by modifying entries in the <a class="external"
        href="https://en.wikipedia.org/wiki/Windows_Registry">Windows Registry</a>, which it
        does by generating and executing a <a class="external"
        href="https://en.wikipedia.org/wiki/Windows_PowerShell">Windows PowerShell</a> script.
        You may execute the script automatically after it is generated, or you can write a
        script file that you can use outside Qana.  In order to run the script, you must have
        PowerShell 2.0 or later installed on your system.
      </p>
      <p class="wrap">
        The command is enabled only if the application is run on Windows.
      </p>

      <h5 id="section8-7-2-1">8.7.2.1&nbsp; <span class="command">The <span class="component">Windows file associations</span> dialog</span></h5>
      <p class="wrap">
        The command brings up a dialog box that controls the content of the PowerShell script
        and the way in which it is used.  At the top of the dialog is a drop-down list from
        which you can select the action that you want to perform: <i>Add</i> creates new file
        associations or modifies existing ones; <i>Remove</i> removes file associations that
        were created with the <i>Add</i> option.  (If you add file associations, you will
        probably want to remove them before you change the the filename suffixes of <a
        class="configProperty" href="#cp-file-filenameSuffix-encrypted">Qana-encrypted files</a>
        or <a class="configProperty" href="#cp-file-filenameSuffix-archive">Qana archives</a> or
        before you uninstall Qana.)  The same script is used for both adding and removing file
        associations; the difference in behaviour is achieved by adding a switch (the argument
        <code>-remove</code>) to the command line when the script is used to remove file
        associations.
      </p>
      <p class="wrap">
        Below the <span class="component">Action</span> drop-down list are fields in which you
        specify the locations of three files that are required to create the file associations.
        The fields are disabled if the selected action is <i>Remove</i> because the locations of
        the files aren&apos;t required when removing file associations, but the content of the
        fields is always included in the script in case you want to retain a single script for
        dual purposes.
      </p>
      <p class="wrap">
        The pathnames of the three files may contain <a href="#sectionA">special constructs</a>
        for system properties and environment variables.  If a specified system property exists,
        the construct that denotes the property key (eg, <code>${java.home}</code>) will be
        replaced by the property value.  Environment variables, however, will not be expanded
        but will be converted to their Windows form (eg, <code>${JAVA_HOME}</code> will be
        converted to <code>%JAVA_HOME%</code>) before they are included in the script.  The
        environment variables will be set in Registry values and expanded by the operating
        system.
      </p>
      <p class="wrap">
        Environment variables of the form <code>%<i>name</i>%</code> may appear in a pathname,
        but they don&apos;t have a special significance in Qana and are treated as literal text.
        If a pathname contains environment variables of this form, you should ensure that the
        <span class="component">Files must exist</span> check box is not selected to avoid an
        error when the pathnames are resolved.
      </p>
      <p class="wrap">
        To add file associations, the files whose locations you must specify are:
      </p>
      <dl class="fileAssoc">
        <dt>Java launcher</dt>
        <dd class="wrap">
          This is the Windows executable that launches a Java program.  You have a choice of
          <code>javaw.exe</code> (no console) or <code>java.exe</code> (console).  The
          corresponding <span class="command">Default</span> command sets the pathname to that
          of the file <code>bin\javaw.exe</code> in the directory specified by the
          <code>java.home</code> system property, which is the Java installation directory that
          is associated with the current Qana application.  If you install another version of
          Java, the Java launcher might be at a different location; if so, you will need to
          update the file association accordingly.
        </dd>
        <dt>JAR</dt>
        <dd class="wrap">
          This is the JAR (Java archive) file of the Qana application.  The corresponding <span
          class="command">Default</span> command sets the pathname to that of the JAR file of
          the current Qana application.  (The command is disabled if the application was not run
          from a JAR file.)
        </dd>
        <dt>Icon</dt>
        <dd class="wrap">
          This is a Windows icon file for Qana.  The file <code>app.ico</code>, which can be
          found in the <code>uk.blankaspect.qana.images</code> package of the application&apos;s
          resources, is provided for this purpose, but you may choose any suitable icon file to
          associate with Qana files.
        </dd>
      </dl>
      <p class="wrap">
        The <span class="component">Files must exist</span> check box below the pathname fields
        should be selected if you want Qana to check that the three files exist before it
        generates a script.  You should not select the check box if any of the pathnames contain
        Windows-form environment variables, but environment variables in the form of <a
        href="#sectionA">special constructs</a> will be expanded when a pathname is resolved.
      </p>
      <p class="wrap">
        The <span class="component">Script life cycle</span> drop-down list controls what
        happens to the PowerShell script after it is generated.  For all options, a script file
        named <code>qanaAssociations.ps1</code> is written to a subdirectory of the
        system&apos;s temporary directory, which is typically <code>AppData\Local\Temp</code>
        within the user&apos;s home directory.  The subdirectory has the prefix
        <code>qana_</code> , and the full pathname is displayed when the script file is written.
        After the file has been written, it may be executed and optionally deleted after
        execution, according to selection from the <span class="component">Script life
        cycle</span> drop-down list.  If you don&apos;t want to preserve the script, the default
        option of <i>Write, execute and delete</i> will add or remove file associations without
        leaving a residue on the file system.
      </p>
      <p class="wrap">
        When you select <span class="command">OK</span>, the pathnames are validated if the
        action is <i>Add</i> and the <span class="component">Files must exist</span> check box
        is selected.  If there is no error, a further dialog box is displayed in which the
        progress of script operations is reported, along with any error messages from Qana or
        the operating system.  The pathname of the script file appears in the first message.
        When the script operations have finished, you can copy the contents of the text area to
        the system clipboard with the dialog&apos;s <span class="command">Copy</span> command.
      </p>

      <h4 id="section8-7-3">8.7.3&nbsp; <span class="command">Preferences</span></h4>
      <p class="wrap">
        The <span class="command">Preferences</span> command brings up a tabbed dialog box in
        which the configuration properties of Qana can be edited.  The properties on the various
        tabbed pages are described below.
      </p>

      <div class="preferences">
        <div>
          <div class="sectionTitle" id="section8-7-3-a">General</div>
        </div>

        <div>
          <div id="cp-general-showUnixPathnames">
            <dl>
              <dt>Display UNIX-style pathnames</dt>
              <dd>
                <div class="wrap">
                  If you select <code>Yes</code>, pathnames are displayed in a reduced
                  &quot;UNIX style&quot; in some parts of the <abbr
                  title="Graphical user interface">GUI</abbr>.  A pathname is converted from its
                  platform-specific form in two steps:
                </div>
                <ol class="noTopMargin">
                  <li class="wrap">
                    If the pathname starts with the user&apos;s home directory, the latter is
                    replaced by <code>~</code>.
                  </li>
                  <li class="wrap">
                    The file-separator character (<code>\</code> on Windows systems) is replaced
                    by <code>/</code>.
                  </li>
                </ol>
              </dd>
              <dd class="spaceAbove wrap">
                The default value is <code>No</code>.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-general-selectTextOnFocusGained">
            <dl>
              <dt>Select text when focus is gained</dt>
              <dd class="wrap">
                If you select <code>Yes</code>, all the text in a text field will be
                automatically selected when the field gains keyboard focus, regardless of how
                the focus is transferred.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is <code>Yes</code>.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-general-mainWindowLocation">
            <dl>
              <dt>Save location of main window</dt>
              <dd class="wrap">
                If you select <code>Yes</code>, the location of the main window on the screen
                will be saved to the configuration file when you exit the application.  The next
                time that Qana is run, its main window will be positioned at the previously
                saved location.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is <code>No</code>.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-general-mainWindowSize">
            <dl>
              <dt>Save size of main window</dt>
              <dd class="wrap">
                If you select <code>Yes</code>, the width and height of the main window will be
                saved to the configuration file when you exit the application.  The next time
                that Qana is run, the dimensions of its main window will be set to the
                previously saved values.
              </dd>
              <dd class="spaceAbove wrap">
                If you select <code>No</code>, the width and height of the main window will be
                determined by the larger of the archive view and the text view for each
                dimension.  The dimensions of the views are themselves determined by the
                properties in the <span class="component">Archive view</span> and <span
                class="component">Text view</span> tabs of the <span
                class="component">Preferences dialog</span>.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is <code>No</code>.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-general-maxEditListLength">
            <dl>
              <dt>Maximum size of edit history</dt>
              <dd class="wrap">
                This is the maximum number of edits that can be stored in a text document&apos;s
                history for use by the <a class="command" href="#section8-3-1">Edit &gt;
                Undo</a> and <a class="command" href="#section8-3-1">Edit &gt; Redo</a>
                commands.  The history of edits can be explicitly cleared with the <a
                class="command" href="#section8-3-2">Edit &gt; Clear edit history</a> command.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is 100.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-general-clearClipboardOnExit">
            <dl>
              <dt>Clear clipboard on exit</dt>
              <dd class="wrap">
                If you select <code>Yes</code>, the system clipboard is cleared when Qana exits.
                Clearing the clipboard will prevent the escape of plaintext from the Qana
                application through this route.  (For example, plaintext may have been copied to
                the clipboard when editing a text document.)  The clipboard is cleared by
                putting an empty string on it.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is <code>Yes</code>.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-general-encryptedFileDragAndDropAction">
            <dl>
              <dt>Encrypted file drag-and-drop action</dt>
              <dd class="wrap">
                When you drag and drop a Qana-encrypted file &mdash; a file whose filename has
                the suffix specified by the <a class="configProperty"
                href="#cp-file-filenameSuffix-encrypted">file.filenameSuffix.encrypted</a>
                configuration property &mdash; onto the main window, it will initiate an action
                according to the value of this property.  If you select <code>Decrypt</code>,
                the file will be decrypted; if you select <code>Validate</code>, the file will
                be validated.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is <code>Decrypt</code>.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-general-carrierImageKind">
            <dl>
              <dt>Autogenerated carrier image kind</dt>
              <dd class="wrap">
                The <a class="command" href="#section8-1-12">File &gt; Conceal file in image</a>
                command, the <a class="command" href="#section8-5-5">Text &gt; Conceal text in
                image</a> command and the <a class="command" href="#section8-6-7">Encryption
                &gt; Generate garbage</a> command can automatically generate images that conceal
                encrypted data &mdash; or, in the case of the <span class="command">Generate
                garbage</span> command, random data.  The generated images have a generic form
                consisting of overlaid polygons.  The edges of the polygons may be linear or one
                of two kinds of cubic curve according to the value of this property.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is <code>Linear</code>.
              </dd>
            </dl>
          </div>
        </div>
      </div>

      <div class="preferences">
        <div>
          <div class="sectionTitle" id="section8-7-3-b">Appearance</div>
        </div>

        <div>
          <div id="cp-appearance-lookAndFeel">
            <dl>
              <dt>Look-and-feel</dt>
              <dd class="wrap">
                The look-and-feel (LAF) can be selected from a list of the LAFs that are
                available on the current system.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is the cross-platform LAF, currently called Metal.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-appearance-textAntialiasing">
            <dl>
              <dt>Text antialiasing</dt>
              <dd class="wrap">
                This determines the kind of antialiasing that is performed when text is drawn in
                custom or partially customised user-interface components (eg, in drop-down
                lists).  Note that antialiasing is only a hint in Java; the implementation is
                not required to perform the chosen antialiasing.
              </dd>
              <dd class="spaceAbove wrap">
                This property has no effect on the antialiasing of text in standard UI
                components, such as labels and menus, which is determined by the Java
                implementation and the desktop setting for antialiasing text (often referred to
                as &quot;font smoothing&quot;).  You can override the desktop setting with the
                unsupported system property <code><a class="external"
                href="https://docs.oracle.com/javase/7/docs/technotes/guides/2d/flags.html#aaFonts">awt.useSystemAAFontSettings</a></code>.
              </dd>
              <dd class="spaceAbove wrap">
                The text antialiasing property can have the following values:
              </dd>
              <dd>
                <dl class="inner1">
                  <dt>Default</dt>
                  <dd class="wrap">
                    The desktop setting for text antialiasing (font smoothing) is used, if the
                    Java implementation recognises one; otherwise, no antialiasing is performed.
                  </dd>

                  <dt>None</dt>
                  <dd class="wrap">
                    No antialiasing is performed.
                  </dd>

                  <dt>Standard</dt>
                  <dd class="wrap">
                    This selects pixel-oriented antialiasing rather than subpixel antialiasing.
                    It is suitable for non-LCD displays.
                  </dd>

                  <dt>Subpixel, horizontal RGB</dt>
                  <dt>Subpixel, horizontal BGR</dt>
                  <dt>Subpixel, vertical RGB</dt>
                  <dt>Subpixel, vertical BGR</dt>
                  <dd class="wrap">
                    These four options are intended to optimise the rendering of text for LCD
                    displays using subpixel antialiasing with subpixels in the chosen
                    arrangement.  Selecting an option that does not correspond to the actual
                    arrangement of subpixels in your LCD display may result in blurred text.
                    The most common arrangement of subpixels is horizontal RGB.
                  </dd>
                </dl>
              </dd>
              <dd class="wrap">
                The default value is <code>Default</code>.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-appearance-statusTextColour">
            <dl>
              <dt>Status text colour</dt>
              <dd class="wrap">
                This is the colour of text in the <a href="#section6-1-3">status panel</a> of
                the main window.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is black.
              </dd>
            </dl>
          </div>
        </div>
      </div>

      <div class="preferences">
        <div>
          <div class="sectionTitle" id="section8-7-3-c">Archive view</div>
        </div>

        <div>
          <div id="cp-archive-view-numRows">
            <dl>
              <dt>Rows</dt>
              <dd class="wrap">
                This is the number of viewable rows of an archive view.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is 20.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-archive-view-columnWidth">
            <dl>
              <dt>Column widths</dt>
              <dd class="wrap">
                These are the widths (in pixels) of the columns in an archive view.  The
                <i>Path</i> column is always visible; the visibility of the other columns can be
                toggled with the check box to the left of the column name.
              </dd>
              <dd class="spaceAbove wrap">
                The <span class="component">Set from current view</span> button issues a command
                to set the column widths to those of the current archive view.
              </dd>
              <dd class="spaceAbove wrap">
                The default values are 240, 96, 112, 400.
              </dd>
            </dl>
          </div>
        </div>
      </div>

      <div class="preferences">
        <div>
          <div class="sectionTitle" id="section8-7-3-d">Text view</div>
        </div>

        <div>
          <div id="cp-text-view-size">
            <dl>
              <dt>Size</dt>
              <dd class="wrap">
                These are the dimensions (number of columns &times; number of rows) of a text
                view.  The physical size of the text view is also determined by its <a
                href="#cp-font">font</a>.
              </dd>
              <dd class="spaceAbove wrap">
                The default dimensions are 80 &times; 24.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-text-view-colour">
            <dl>
              <dt>Colours</dt>
              <dd class="wrap">
                These are the colours that are used when drawing text in a text view.  Clicking
                on a colour button brings up a colour-selection dialog.
              </dd>
            </dl>
          </div>
        </div>
      </div>

      <div class="preferences">
        <div>
          <div class="sectionTitle" id="section8-7-3-e">Text</div>
        </div>

        <div>
          <div id="cp-text-wrap-defaultLineLength">
            <dl>
              <dt>Text wrap: default line length</dt>
              <dd class="wrap">
                This is the default length of a line of text that appears in the <span
                class="component">Text-wrap dialog</span> when the <a class="command"
                href="#section8-3-8">Edit &gt; Wrap text</a> command is first issued.  The line
                length that is applied when text is wrapped can be specified in the <span
                class="component">Text-wrap dialog</span>.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is 80 characters.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-text-wrap-endOfSentencePattern">
            <dl>
              <dt>Text wrap: end-of-sentence pattern</dt>
              <dd>
                <p class="wrap">
                  This is the target pattern of the regular expression that is used by the
                  text-wrapping algorithm to search for the ends of sentences within the text
                  that is being wrapped.  The consecutive space characters (U+0020) that follow
                  the end of a sentence are replaced by the number of spaces specified by the <a
                  class="configProperty"
                  href="#cp-text-wrap-numSpacesBetweenSentences">text.wrap.numSpacesBetweenSentences</a>
                  property.
                </p>
                <p class="wrap">
                  The default pattern is
                  <code>(?:(?:\p{L}|\p{N}|[&apos;&quot;&raquo;&ldquo;)\]&gt;%])[.!?])|(?:(?:\p{L}|\p{N})[.!?][&apos;&quot;&raquo;&ldquo;)\]&gt;%])</code>
                </p>
                <p class="wrap">
                  A simplified English translation of this pattern is:
                </p>
                <div class="highlighted">
                  <div class="wrap">
                    The end of a sentence is either (a) a letter character or a number character
                    or a special terminator followed by an end-of-sentence character, or (b) a
                    letter character or a number character followed by an end-of-sentence
                    character and a special terminator, where
                  </div>
                  <ul class="continuationList">
                    <li class="wrap">
                      <i>special terminator</i> is one of
                      <code>&apos;&quot;&raquo;&ldquo;)]&gt;%</code> ,
                    </li>
                    <li class="wrap">
                      <i>end-of-sentence character</i> is one of <code>.!?</code> , and
                    </li>
                    <li class="wrap">
                      within the conditions (a) and (b), <i>or</i> takes precedence over
                      <i>followed by</i>.
                    </li>
                  </ul>
                </div>
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-text-wrap-numSpacesBetweenSentences">
            <dl>
              <dt>Text wrap: number of spaces between sentences</dt>
              <dd class="wrap">
                This is the number of space characters (U+0020) with which the text-wrapping
                algorithm will replace the consecutive spaces between the end of one sentence
                and the start of the next sentence.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is 2.
              </dd>
            </dl>
          </div>
        </div>
      </div>

      <div class="preferences">
        <div>
          <div class="sectionTitle" id="section8-7-3-f">Files</div>
        </div>

        <div>
          <div id="cp-file-filenameSuffix-encrypted">
            <dl>
              <dt>Filename suffix: encrypted files</dt>
              <dd class="wrap">
                This is the suffix that will be given by default to the names of files that are
                encrypted with the <a class="command" href="#section8-1-8">File &gt; Encrypt
                file</a> command.  It will be used as a filter in file-selection dialogs that
                relate to encrypted files.
              </dd>
              <dd class="spaceAbove wrap">
                The default suffix is <code>.qana</code>.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-file-filenameSuffix-archive">
            <dl>
              <dt>Filename suffix: archive database files</dt>
              <dd class="wrap">
                This is the suffix that will be given by default to the names of archive
                database files (ie, files that are saved with the <a class="command"
                href="#section8-1-6">File &gt; Save archive</a> command).  It will be used as a
                filter in file-selection dialogs for archive documents.
              </dd>
              <dd class="spaceAbove wrap">
                The default suffix is <code>.qarc</code>.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-file-selectEncryptDecryptOutputFile">
            <dl>
              <dt>Select encrypt/decrypt output file</dt>
              <dd class="wrap">
                A general file can be encrypted or decrypted either with a menu command or by
                dragging the file and dropping it onto the main window.  In both cases, the
                pathname of the output file can be derived from the name of the input file or it
                can be selected in a dialog box.  This property allows you to choose &mdash; for
                each of the action sources: menu command or drag-and-drop &mdash; whether the
                output file can be selected.
              </dd>
              <dd class="spaceAbove wrap">
                The default value for <i>Menu command</i> is <code>true</code>; the default
                value for <i>Drag-and-drop</i> is <code>false</code>.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-file-erasureNumPasses">
            <dl>
              <dt>Number of passes when erasing a file</dt>
              <dd class="wrap">
                This is the number of times that the contents of a file will be overwritten with
                random data when the file is erased with the <a class="command"
                href="#section8-1-15">File &gt; Erase files</a> command.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is 4.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-file-saveFileSelectionPathnames">
            <dl>
              <dt>Save pathnames from file-selection dialogs</dt>
              <dd class="wrap">
                If you select <code>Yes</code>, the pathnames of the current directories from
                the principal file-selection dialogs are saved when Qana exits.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is <code>No</code>.
              </dd>
            </dl>
          </div>
        </div>
      </div>

      <div class="preferences">
        <div>
          <div class="sectionTitle" id="section8-7-3-g">Keys</div>
        </div>

        <div>
          <div id="cp-crypto-keyDatabase">
            <dl>
              <dt>Key database</dt>
              <dd class="wrap">
                This is the pathname of the database file of persistent <a
                href="#section4-3">user keys</a>.
              </dd>
              <dd class="spaceAbove">
                <div class="wrap">
                  The default pathname is
                </div>
                <ul class="continuationList">
                  <li class="wrap">
                    <code>~/.blankaspect/qana/qana.keys</code> under Linux, where <code>~</code>
                    denotes the user&apos;s home directory, or
                  </li>
                  <li class="wrap">
                    <code>%APPDATA%\blankaspect\qana\qana.keys</code> under Windows, where
                    <code>%APPDATA%</code> is a system environment variable.
                  </li>
                </ul>
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-crypto-warnTemporaryKey">
            <dl>
              <dt>Warn of use of temporary key</dt>
              <dd class="wrap">
                The passphrase of a <a href="#defTemporaryKey">temporary key</a> is entered only
                once, when the key is created.  If the passphrase was entered incorrectly and
                the temporary key is used for encryption, there is a danger that the encrypted
                data may be inaccessible when the key is destroyed at the end of the Qana
                session.  If you select <code>Yes</code>, a warning will be displayed whenever a
                temporary key is used for encryption.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is <code>Yes</code>.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-crypto-kdfParameters">
            <dl>
              <dt>Key-derivation function</dt>
              <dd class="wrap">
                These are the default <a href="#section4-1-1">parameters</a> of the scrypt
                key-derivation function (KDF), along with the maximum number of threads that
                will be used in generating a key.  There is a separate set of parameters for
                each of the two uses of the KDF (key verification and <abbr
                title="Content-encryption key">CEK</abbr> generation).
              </dd>
              <dd class="spaceAbove wrap">
                The <span class="component">Generate a test key</span> button issues a command
                to generate a test key with the current parameters.  After a key is generated,
                the number of milliseconds that it took to generate it will be displayed in the
                box to the right of the button.  An error message will be displayed if there is
                not enough memory to run the key-derivation function.
              </dd>
              <dd class="spaceAbove wrap">
                The default values of the KDF parameters are: rounds = 8, cost = 16, blocks = 8,
                parallel superblocks = 1, threads = 0.
              </dd>
            </dl>
          </div>
        </div>
      </div>

      <div class="preferences">
        <div>
          <div class="sectionTitle" id="section8-7-3-h">Entropy</div>
        </div>

        <div>
          <div id="cp-entropy-seedFileDirectory">
            <dl>
              <dt>Directory of seed file</dt>
              <dd class="wrap">
                Qana uses an optional <a href="#section9-3">seed file</a> &mdash; a small file
                of random data &mdash; to seed the pseudo-random number generator (PRNG) when
                the application starts up, so that the PRNG can generate random data
                immediately, without having to wait for entropy to be accumulated.  The seed
                file is updated with fresh random data after it is read, and it is updated again
                when the application exits.
              </dd>
              <dd class="spaceAbove wrap">
                This property is the directory in which Qana expects to find the seed file,
                which is named <code>fortunaSeed.dat</code>.  If the directory field is left
                empty, no seed file is read or written.
              </dd>
              <dd class="spaceAbove">
                <div class="wrap">
                  The default directory is
                </div>
                <ul class="continuationList">
                  <li class="wrap">
                    <code>~/.blankaspect/qana</code> under Linux, where <code>~</code> denotes
                    the user&apos;s home directory, or
                  </li>
                  <li class="wrap">
                    <code>%APPDATA%\blankaspect\qana</code> under Windows, where
                    <code>%APPDATA%</code> is a system environment variable.
                  </li>
                </ul>
                <div class="wrap">
                  This is the same directory as the default location of a configuration file.
                </div>
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-entropy-warnNotSeeded">
            <dl>
              <dt>Warn if not seeded</dt>
              <dd>
                <div class="wrap">
                  If you select <code>Yes</code>, a warning is displayed if the pseudo-random
                  number generator (PRNG) is not seeded when Qana starts up.  The PRNG may not
                  be seeded for one of several reasons:
                </div>
                <ul class="continuationList">
                  <li class="wrap">
                    the use of a seed file has been disabled by specifying an empty pathname for
                    the <a class="configProperty" href="#cp-entropy-seedFileDirectory">seed-file
                    directory</a>, or
                  </li>
                  <li class="wrap">
                    the specified seed file was not read, or
                  </li>
                  <li class="wrap">
                    the seed file did not contain enough random data to allow the PRNG to be
                    reseeded.
                  </li>
                </ul>
              </dd>
              <dd class="spaceAbove wrap">
                If you disable the use of a seed file, you will probably want to suppress the
                warning that the PRNG has not been seeded.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is <code>Yes</code>.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-entropy-timerDivisor">
            <dl>
              <dt>High-resolution timer divisor</dt>
              <dd class="wrap">
                Two of the entropy sources &mdash; keyboard and timer &mdash; depend on the
                high-resolution timer of the Java virtual machine, which has nanosecond
                precision but not necessarily nanosecond resolution.  The time value that is
                used by the two entropy sources is the value of the high-resolution timer
                divided by the value of this property.  If the resolution of the timer is lower
                than its precision, you can adjust the divisor so that the resolution and
                precision of the time value are equal in order to maximise the entropy of its
                low-order bits.  For example, if the high-resolution timer is based on a 10 MHz
                hardware timer, its resolution will be 100 nanoseconds, so a divisor of 100 will
                equalise the resolution and precision of the time value.
              </dd>
              <dd class="spaceAbove wrap">
                The default value is 1.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-entropy-source-bitMask">
            <dl>
              <dt>Bit mask</dt>
              <dd class="wrap">
                The grid represents a bit mask: for each of the three entropy sources (keyboard,
                mouse and high-resolution timer), the bits that are selected in the grid are the
                bits of the source that will be sampled and added to the entropy pools of the
                Fortuna pseudo-random number generator.  A bit is toggled by clicking on its
                cell or by pressing Space when the grid has keyboard focus.
              </dd>
              <dd class="spaceAbove wrap">
                The bit mask may contain a maximum of four 1-bits.  If the bit mask is empty,
                the source is disabled.
              </dd>
              <dd class="spaceAbove wrap">
                The default value for all sources is the four low-order bits.
              </dd>
            </dl>
          </div>
        </div>
        <div>
          <div id="cp-entropy-source-interval">
            <dl>
              <dt>Interval</dt>
              <dd class="wrap">
                For each of the two entropy sources that are sampled at intervals (mouse and
                timer), this is the interval in milliseconds between samples.
              </dd>
              <dd class="spaceAbove wrap">
                The default value for both sources is 4 milliseconds.
              </dd>
            </dl>
          </div>
        </div>
      </div>

      <div class="preferences">
        <div>
          <div class="sectionTitle" id="section8-7-3-i">Fonts</div>
        </div>

        <div>
          <div id="cp-font">
            <dl>
              <dd class="wrap">
                These are the fonts that are used in Qana&apos;s display.  Remember that font
                names may be platform-dependent, so that a configuration that specifies font
                names may not work across platforms.
              </dd>
              <dd class="spaceAbove wrap">
                The <i>main</i> font is used for various components including labels (static
                text), menus, buttons and list boxes.
              </dd>
              <dd class="spaceAbove wrap">
                The <i>text field</i> font is used for text fields, spinners and some other text
                components.
              </dd>
              <dd class="spaceAbove wrap">
                The <i>combo box</i> font is used for drop-down lists and related components.
              </dd>
              <dd class="spaceAbove wrap">
                The <i>text view</i> font is used for the <a href="#section6-1-2">text view</a>.
              </dd>
              <dd class="spaceAbove wrap">
                The default values of all the font properties are those of the default fonts for
                the platform and look-and-feel.  A default font size is specified by leaving the
                <span class="component">Size</span> field empty (the minimum position on the
                spinner).  A default font is used if no font name is specified in Qana&apos;s
                configuration or if the named font is not available.
              </dd>
            </dl>
          </div>
        </div>
      </div>

      <p class="wrap">
        Some of the configuration properties will take effect when the <span
        class="component">Preferences</span> dialog is accepted (by closing it with <span
        class="command">OK</span>); other properties (eg, the look-and-feel and fonts) will not
        take effect until the next time that Qana is run.
      </p>
      <p class="wrap">
        The <a href="#section3-2">configuration file</a> is normally saved automatically when
        Qana exits, if the configuration has changed.  The <span class="command">Save
        configuration</span> command in the <span class="component">Preferences</span> dialog
        can be used to save a configuration file explicitly.
      </p>

    </div>

    <!--=====================================================================================-->

    <!-- Entropy -->

    <div class="section">
      <h2 id="section9">9&nbsp; Entropy</h2>
      <p class="tocLink">
        [ <a href="#toc">Table of contents</a> ]
      </p>

      <p class="wrap">
        In information theory, <a class="external"
        href="https://en.wikipedia.org/wiki/Entropy_%28information_theory%29">entropy</a> is a
        measure of unpredictability.  The term is used here in the specific context of the
        unpredictability of the output of the Fortuna pseudo-random number generator, which is
        used by Qana for various purposes (eg, for generating keystreams for its cipher and
        cryptographic salts).
      </p>
      <p class="wrap">
        The sequence of numbers generated by a pseudo-random number generator (PRNG) is called
        pseudo-random rather than random because it is deterministic: the sequence is fully
        determined by its initial state, which, in the case of the Fortuna PRNG, is its
        <i>seed</i>.  Given the same seed, the PRNG will always generate the same sequence of
        numbers.  This reproducibility is a desirable property in some circumstances; for
        example, in Qana, where a content-encryption key (CEK) is used as the seed for the PRNG
        that generates the keystream of a cipher, it is essential that the same CEK always
        generate the same sequence of numbers for the keystream so that the CEK that was used to
        encrypt some plaintext will also decrypt the ciphertext.
      </p>
      <p class="wrap">
        However, there are other parts of the encryption system in which something close to true
        randomness is required.  To achieve this, Fortuna has an <i>entropy accumulator</i>,
        which collects truly random data &mdash; entropy &mdash; from several sources, and
        reseeds the number generator with it when a sufficient quantity of random data has been
        collected.  The entropy is collected in 32 pools.  The random data that arrives from the
        various sources is distributed evenly among the pools, but the rate at which the entropy
        is extracted from the pools to reseed the generator decreases exponentially across the
        set of pools.  This means that higher-numbered pools will accumulate more entropy than
        lower-numbered pools because entropy will be extracted from them less frequently to
        reseed the generator.
      </p>
      <p class="wrap">
        Qana has a single instance of a Fortuna PRNG with an entropy accumulator.  The status of
        the entropy accumulator is shown in the first field of the <a
        href="#section6-1-3">status panel</a> of the main window, where a green tick indicates
        that there is enough entropy to reseed the PRNG.  For maximum security when encrypting
        data, it is recommended that you do so only when a tick is showing.  (If you do not use
        a <a href="#section9-3">seed file</a>, it is particularly important that you wait for
        the tick to appear before encrypting after Qana starts up.)  Depending on the
        configuration of the entropy sources, this may mean waiting for enough entropy to be
        extracted from the system timer, or you may have to generate the entropy yourself by
        pressing keys or moving the mouse.
      </p>
      <p class="wrap">
        The entropy accumulator has three possible sources:
      </p>
      <table class="basic">
        <tr>
          <td class="definitionTerm">Keyboard</td>
          <td class="wrap">
            The random data is the interval between successive key presses, measured by a <a
            href="#section9-1">high-resolution timer</a>.  Entropy is generated whenever a key
            is pressed.
          </td>
        </tr>
        <tr>
          <td class="definitionTerm">Mouse</td>
          <td class="wrap">
            The random data is a combination of the <i>x</i> and <i>y</i> coordinates of the
            mouse cursor.  Entropy is generated whenever the mouse is moved or dragged and a
            specified interval has elapsed since the position of the mouse cursor was last
            sampled.
          </td>
        </tr>
        <tr>
          <td class="definitionTerm">Timer</td>
          <td class="wrap">
            The random data is the value of a <a href="#section9-1">high-resolution timer</a>.
            Entropy is generated when the value of the timer is repeatedly sampled at a
            specified regular interval.  It is assumed that there will be small, random
            irregularities in the actual sampling interval owing to variations in <a
            class="external"
            href="https://en.wikipedia.org/wiki/Scheduling_%28computing%29">scheduling</a>.
          </td>
        </tr>
      </table>
      <p class="wrap">
        The low-order bits of the sampled value are used in all three cases.  The number of bits
        can be specified separately for each source with a set of <a class="configProperty"
        href="#cp-entropy-source-bitMask">configuration properties</a>; if the number of bits is
        zero, the source is disabled.
      </p>
      <p class="wrap">
        For the two sources that are sampled at intervals (mouse and timer), the interval
        between samples can be specified separately for each source with a set of <a
        class="configProperty" href="#cp-entropy-source-interval">configuration properties</a>.
      </p>

      <h3 id="section9-1">9.1&nbsp; High-resolution timer</h3>

      <p class="wrap">
        Two of the entropy sources &mdash; keyboard and timer &mdash; depend on the
        high-resolution timer of the Java virtual machine (JVM), which has nanosecond precision
        but not necessarily nanosecond resolution.  The time value that is used by the two
        entropy sources is the value of the high-resolution timer divided by the value of the <a
        class="configProperty" href="#cp-entropy-timerDivisor">entropy.timerDivisor</a>
        configuration property.  The divisor can be adjusted so that the resolution and
        precision of the time value are equal in order to maximise the entropy of its low-order
        bits.  For example, if the JVM&apos;s high-resolution time source is based on a 10 MHz
        hardware timer (ie, a resolution of 100 nanoseconds), a divisor of 100 will reduce the
        precision of the time value to the resolution.  If the frequency of the underlying
        hardware timer is not known, it may be possible to tune the divisor by observing the <a
        href="#section9-2">entropy metrics</a>, which give an indication of the quality of the
        entropy of the timer bits.
      </p>

      <h3 id="section9-2">9.2&nbsp; Entropy metrics</h3>

      <p class="wrap">
        Qana can display some measurements relating to the supposedly random data that is
        supplied to the entropy pools of the Fortuna <abbr
        title="Pseudo-random number generator">PRNG</abbr>, along with the status of the 32
        entropy pools.  The metrics are intended to give a visual indication of the quality of
        the entropy sources, and may be useful for assessing the effect of changes to the
        entropy-related configuration properties.  The metrics are reset when any of the
        configuration properties are changed.
      </p>
      <p class="wrap">
        The entropy metrics are displayed with the <a class="command"
        href="#section8-6-6">Encryption &gt; Show entropy metrics</a> command, which brings up a
        dialog box that contains one or two titled panels: if any entropy sources are enabled,
        there is an <span class="component">Entropy sources</span> panel and an <span
        class="component">Entropy pools</span> panel; otherwise, there is only an <span
        class="component">Entropy pools</span> panel.
      </p>
      <p class="wrap">
        The <span class="component">Entropy sources</span> panel contains a tabbed panel that
        has a tab for each entropy source that is enabled.  Within each tabbed page are two
        further panels:
      </p>
      <ul class="list">
        <li class="spaced wrap">
          On the left is a plot of the relative frequencies of 1-bits for each bit of the
          entropy source.  The bars are drawn upwards (red) and downwards (blue) from the
          mid-line of the plot, which denotes the expected value (a relative frequency of 0.5):
          if the bar is above the mid-line, there are more 1-bits than 0-bits; if the bar is
          below the mid-line, there are more 0-bits than 1-bits.  The numerical value of the
          relative frequency for each bit is displayed in a tooltip when the mouse cursor hovers
          over the plot.
        </li>
        <li class="spaced wrap">
          On the right is a set of plots of the relative frequencies of all possible 8-bit
          sequences, from 00000000 to 11111111.  There is a separate plot for each bit of the
          entropy source.  The bars are drawn upwards (red) and downwards (blue) from the
          mid-line of the plot, which denotes the expected value (a relative frequency of 1/256
          &asymp; 0.0039).  The lengths of the bars are normalised over all the plots so that
          the longest bar extends to either the top or bottom of the plot.  The numerical value
          of the relative frequency for each bit sequence is displayed in a tooltip when the
          mouse cursor hovers over the plot.
        </li>
      </ul>
      <p class="wrap">
        As more entropy accumulates, the relative frequencies of all the plotted values should
        tend towards their expected values (the mid-lines of the plots) if the entropy is of a
        high quality.  Patterns or anomalous regions (eg, prominent spikes) in any of the plots
        may indicate that the entropy from particular bits of the source are of a low quality,
        especially if they reappear in the same place after the entropy metrics are reset.  If
        you consider the entropy from a particular source to be of insufficient quality, you
        could try different bits of the source, or you could disable the source altogether.
      </p>
      <p class="wrap">
        The <span class="component">Entropy pools</span> panel contains a plot of the entropy
        content of the each of the entropy pools of the PRNG.  The heights of the bars are
        plotted on a logarithmic scale.  The bars are green when there is enough entropy to
        reseed the PRNG and red otherwise.  The numerical value of the amount of entropy in each
        pool is displayed in a tooltip when the mouse cursor hovers over the plot.
      </p>
      <p class="wrap">
        The display of entropy metrics is not updated automatically; to update the display, you
        will need to issue the <span class="command">Update</span> command (Ctrl+Space).
      </p>
      <p class="wrap">
        The <span class="command">Clear</span> command (Ctrl+Delete) resets the measurements for
        all the entropy sources.
      </p>

      <h3 id="section9-3">9.3&nbsp; The seed file</h3>

      <p class="wrap">
        When Qana starts up, it seeds the <abbr
        title="Pseudo-random number generator">PRNG</abbr> with low-order bits from the <a
        href="#section9-1">high-resolution timer</a>, which it samples several times over a
        short interval, using the <a class="configProperty"
        href="#cp-entropy-timerDivisor">entropy.timerDivisor</a> configuration property to
        divide the values from the timer.  It is quite possible that the resulting seed has low
        entropy &mdash; particularly if your system has no high-resolution time source.  You can
        risk using the PRNG immediately or, if you&apos;re patient, you can wait until enough
        entropy has accumulated to reseed the PRNG, generating the entropy yourself if the timer
        source is not enabled.  However, there is another option: a <i>seed file</i> may be used
        to provide some initial entropy for the PRNG, allowing you to perform encryption
        securely as soon as Qana has started up.
      </p>
      <p class="wrap">
        A seed file is a small file of random data that is stored at a location known to Qana.
        When the application starts up, it reads the file, extracts the random data from it and
        adds the data to the first pool of the entropy accumulator to allow the PRNG to be
        reseeded.  If the generator was successfully reseeded, the seed file is replaced with
        new random data from the PRNG; otherwise, the seed file is deleted.  When Qana exits,
        the seed file is replaced with fresh data from the PRNG, which will be used when the
        program is next run.
      </p>
      <p class="wrap">
        The seed file has a fixed name, <code>fortunaSeed.dat</code>, and its directory is
        specified with the <a class="configProperty"
        href="#cp-entropy-seedFileDirectory">entropy.seedFileDirectory</a> configuration
        property.  If the pathname of the directory is an empty string, the use of a seed file
        is disabled.
      </p>
      <p class="wrap">
        If the PRNG is not reseeded when Qana starts up, a warning is displayed.  (The generator
        might not have been reseeded because the use of a seed file is disabled or the seed file
        could not be found.)  The warnings are controlled with the <a class="configProperty"
        href="#cp-entropy-warnNotSeeded">entropy.warnNotSeeded</a> configuration property.  You
        will probably want to suppress warnings if you have chosen not to use a seed file.
      </p>

    </div>

    <!--=====================================================================================-->

    <!-- Special constructs in pathnames -->

    <div class="section">
      <h2 id="sectionA">Appendix A:&nbsp; Special constructs in pathnames</h2>
      <p class="tocLink">
        [ <a href="#toc">Table of contents</a> ]
      </p>

      <p class="wrap">
        Where indicated elsewhere in this document, pathname parameters and properties in Qana
        can contain special constructs for system properties, environment variables and the
        user&apos;s home directory.  The special constructs are expanded when the pathname is
        used.
      </p>

      <dl class="basic">
        <dt>System properties and environment variables</dt>
        <dd class="wrap">
          Java system properties (eg, the user&apos;s home directory, <code>user.home</code>)
          and environment variables (eg, <code>PATH</code>) are referenced by enclosing them
          between <code>${</code> and <code>}</code>; that is, they must have the form
          <code>${&lt;<i>name</i>&gt;}</code>.  A Java system property takes precedence over an
          environment variable with the same name.
        </dd>
        <dd class="wrap">
          &bull; Example: <code>${user.home}/projects</code>
        </dd>
        <dd class="wrap">
          &bull; Example: <code>${HOME}/projects</code>
        </dd>
        <dd class="wrap">
          A Java system property can be specified by prefixing <code>sys.</code> to it.
        </dd>
        <dd class="wrap">
          &bull; Example: <code>${sys.user.home}/projects</code>
        </dd>
        <dd class="wrap">
          An environment variable can be specified by prefixing <code>env.</code> to it.
        </dd>
        <dd class="wrap">
          &bull; Example: <code>${env.HOME}/projects</code>
        </dd>

        <dt>User&apos;s home directory</dt>
        <dd class="wrap">
          A leading <code>~</code> in a pathname is expanded into the user&apos;s home directory
          using the <code>user.home</code> system property, which is usually equivalent to the
          environment variable <code>$HOME</code> on Linux/UNIX systems or
          <code>%USERPROFILE%</code> on Windows systems.
        </dd>
        <dd class="wrap">
          &bull; Example: <code>~/projects</code>
        </dd>
      </dl>

    </div>

    <!--=====================================================================================-->

    <!-- Configuration properties -->

    <div class="section">
      <h2 id="sectionB">Appendix B:&nbsp; Configuration properties</h2>
      <p class="tocLink">
        [ <a href="#toc">Table of contents</a> ]
      </p>

      <p class="wrap">
        The table below lists the configuration properties of Qana.  Apart from the <span
        class="configProperty">app.configDir</span> property, which, for obvious reasons, cannot
        be used within a configuration file, all properties can be used in the two configuration
        locations: command-line properties and configuration file.
      </p>
      <p class="wrap">
        When used in a <code>-D</code> command-line property, <code>app.</code> must be prefixed
        to the property key (eg, <span
        class="configProperty">app.general.mainWindowLocation</span>).
      </p>
      <p class="wrap">
        Any commas (<code>,</code>) or backslash characters (<code>\</code>) in the name of a
        font must be escaped by prefixing a <code>\</code> character to them.
      </p>
      <p class="noBottomMargin wrap">
        In the table below, the initial character of an italicised component of a property value
        denotes its data type according to the following convention:
      </p>

      <table class="dataType">
        <tr>
          <td><i>b</i></td>
          <td>integer (binary representation)</td>
        </tr>
        <tr>
          <td><i>i</i></td>
          <td>integer (decimal representation)</td>
        </tr>
        <tr>
          <td><i>p</i></td>
          <td>
            platform-specific pathname, which may contain <a href="#sectionA">special
            constructs</a>
          </td>
        </tr>
        <tr>
          <td><i>s</i></td>
          <td>string</td>
        </tr>
      </table>

      <table class="configProperties">
        <tr>
          <th>Property key</th>
          <th>Property value</th>
        </tr>

        <tr>
          <td class="propertyKey">configDir</td>
          <td class="propertyValue"><i>pPathname</i></td>
        </tr>

        <tr>
          <td class="propertyKey">appearance.lookAndFeel</td>
          <td class="propertyValue"><i>sName</i></td>
        </tr>
        <tr>
          <td class="propertyKey">appearance.statusTextColour</td>
          <td class="propertyValue">
            <i>iRed</i>, <i>iGreen</i>, <i>iBlue</i>
          </td>
        </tr>
        <tr>
          <td class="propertyKey">appearance.textAntialiasing</td>
          <td class="propertyValue">
            default | none | normal | subpixelHRgb | subpixelHBgr | subpixelVRgb | subpixelVBgr
          </td>
        </tr>

        <tr>
          <td class="propertyKey">archive.view.columnWidth.hashValue</td>
          <td class="propertyValue"><i>iWidth</i></td>
        </tr>
        <tr>
          <td class="propertyKey">archive.view.columnWidth.path</td>
          <td class="propertyValue"><i>iWidth</i></td>
        </tr>
        <tr>
          <td class="propertyKey">archive.view.columnWidth.size</td>
          <td class="propertyValue"><i>iWidth</i></td>
        </tr>
        <tr>
          <td class="propertyKey">archive.view.columnWidth.timestamp</td>
          <td class="propertyValue"><i>iWidth</i></td>
        </tr>
        <tr>
          <td class="propertyKey">archive.view.numRows</td>
          <td class="propertyValue"><i>iNumRows</i></td>
        </tr>

        <tr>
          <td class="propertyKey">crypto.autoUseGlobalKey</td>
          <td class="propertyValue">false | true</td>
        </tr>
        <tr>
          <td class="propertyKey">crypto.kdfParameters.generation</td>
          <td class="propertyValue">
            <i>iNumRounds</i>, <i>iCost</i>, <i>iNumBlocks</i>, <i>iNumParallelBlocks</i>,
            <i>iNumThreads</i>
          </td>
        </tr>
        <tr>
          <td class="propertyKey">crypto.kdfParameters.verification</td>
          <td class="propertyValue">
            <i>iNumRounds</i>, <i>iCost</i>, <i>iNumBlocks</i>, <i>iNumParallelBlocks</i>,
            <i>iNumThreads</i>
          </td>
        </tr>
        <tr>
          <td class="propertyKey">crypto.keyDatabase</td>
          <td class="propertyValue"><i>pPathname</i></td>
        </tr>
        <tr>
          <td class="propertyKey">crypto.prngDefaultCipher</td>
          <td class="propertyValue">aes256 | salsa20</td>
        </tr>
        <tr>
          <td class="propertyKey">crypto.warnTemporaryKey</td>
          <td class="propertyValue">false | true</td>
        </tr>
        <tr>
          <td class="propertyKey">crypto.wrapCiphertextInXml</td>
          <td class="propertyValue">false | true</td>
        </tr>

        <tr>
          <td class="propertyKey">entropy.seedFileDirectory</td>
          <td class="propertyValue"><i>pPathname</i></td>
        </tr>
        <tr>
          <td class="propertyKey">entropy.source.bitMask.keyboard</td>
          <td class="propertyValue"><i>bBitMask</i></td>
        </tr>
        <tr>
          <td class="propertyKey">entropy.source.bitMask.mouse</td>
          <td class="propertyValue"><i>bBitMask</i></td>
        </tr>
        <tr>
          <td class="propertyKey">entropy.source.bitMask.timer</td>
          <td class="propertyValue"><i>bBitMask</i></td>
        </tr>
        <tr>
          <td class="propertyKey">entropy.source.interval.mouse</td>
          <td class="propertyValue"><i>iMilliseconds</i></td>
        </tr>
        <tr>
          <td class="propertyKey">entropy.source.interval.timer</td>
          <td class="propertyValue"><i>iMilliseconds</i></td>
        </tr>
        <tr>
          <td class="propertyKey">entropy.timerDivisor</td>
          <td class="propertyValue"><i>iDivisor</i></td>
        </tr>
        <tr>
          <td class="propertyKey">entropy.warnNotSeeded</td>
          <td class="propertyValue">false | true</td>
        </tr>

        <tr>
          <td class="propertyKey">file.erasureNumPasses</td>
          <td class="propertyValue"><i>iNumPasses</i></td>
        </tr>
        <tr>
          <td class="propertyKey">file.filenameSuffix.archive</td>
          <td class="propertyValue"><i>sSuffix</i></td>
        </tr>
        <tr>
          <td class="propertyKey">file.filenameSuffix.encrypted</td>
          <td class="propertyValue"><i>sSuffix</i></td>
        </tr>
        <tr>
          <td class="propertyKey">file.saveFileSelectionPathnames</td>
          <td class="propertyValue">false | true</td>
        </tr>
        <tr>
          <td class="propertyKey">file.selectEncryptDecryptOutputFile.dragAndDrop</td>
          <td class="propertyValue">false | true</td>
        </tr>
        <tr>
          <td class="propertyKey">file.selectEncryptDecryptOutputFile.menuCommand</td>
          <td class="propertyValue">false | true</td>
        </tr>

        <tr>
          <td class="propertyKey">font.comboBox</td>
          <td class="propertyValue">
            <i>sName</i>, plain | bold | italic | boldItalic, <i>iSize</i>
          </td>
        </tr>
        <tr>
          <td class="propertyKey">font.main</td>
          <td class="propertyValue">
            <i>sName</i>, plain | bold | italic | boldItalic, <i>iSize</i>
          </td>
        </tr>
        <tr>
          <td class="propertyKey">font.textField</td>
          <td class="propertyValue">
            <i>sName</i>, plain | bold | italic | boldItalic, <i>iSize</i>
          </td>
        </tr>
        <tr>
          <td class="propertyKey">font.textView</td>
          <td class="propertyValue">
            <i>sName</i>, plain | bold | italic | boldItalic, <i>iSize</i>
          </td>
        </tr>

        <tr>
          <td class="propertyKey">general.carrierImageKind</td>
          <td class="propertyValue">linear | cubic1 | cubic2</td>
        </tr>
        <tr>
          <td class="propertyKey">general.clearClipboardOnExit</td>
          <td class="propertyValue">false | true</td>
        </tr>
        <tr>
          <td class="propertyKey">general.encryptedFileDragAndDropAction</td>
          <td class="propertyValue">decrypt | validate</td>
        </tr>
        <tr>
          <td class="propertyKey">general.mainWindowLocation</td>
          <td class="propertyValue">
            <i>iX</i>, <i>iY</i>
          </td>
        </tr>
        <tr>
          <td class="propertyKey">general.mainWindowSize</td>
          <td class="propertyValue">
            <i>iWidth</i>, <i>iHeight</i>
          </td>
        </tr>
        <tr>
          <td class="propertyKey">general.maxEditListLength</td>
          <td class="propertyValue"><i>iLength</i></td>
        </tr>
        <tr>
          <td class="propertyKey">general.selectTextOnFocusGained</td>
          <td class="propertyValue">false | true</td>
        </tr>
        <tr>
          <td class="propertyKey">general.showFullPathnames</td>
          <td class="propertyValue">false | true</td>
        </tr>
        <tr>
          <td class="propertyKey">general.showUnixPathnames</td>
          <td class="propertyValue">false | true</td>
        </tr>

        <tr>
          <td class="propertyKey">split.filePartLengthLowerBound</td>
          <td class="propertyValue">
            <i>iValue</i> (B | KiB | MiB)
          </td>
        </tr>
        <tr>
          <td class="propertyKey">split.filePartLengthUpperBound</td>
          <td class="propertyValue">
            <i>iValue</i> (B | KiB | MiB)
          </td>
        </tr>

        <tr>
          <td class="propertyKey">text.view.colour.background</td>
          <td class="propertyValue">
            <i>iRed</i>, <i>iGreen</i>, <i>iBlue</i>
          </td>
        </tr>
        <tr>
          <td class="propertyKey">text.view.colour.selectionBackground</td>
          <td class="propertyValue">
            <i>iRed</i>, <i>iGreen</i>, <i>iBlue</i>
          </td>
        </tr>
        <tr>
          <td class="propertyKey">text.view.colour.selectionText</td>
          <td class="propertyValue">
            <i>iRed</i>, <i>iGreen</i>, <i>iBlue</i>
          </td>
        </tr>
        <tr>
          <td class="propertyKey">text.view.colour.text</td>
          <td class="propertyValue">
            <i>iRed</i>, <i>iGreen</i>, <i>iBlue</i>
          </td>
        </tr>
        <tr>
          <td class="propertyKey">text.view.size</td>
          <td class="propertyValue">
            <i>iNumColumns</i>, <i>iNumRows</i>
          </td>
        </tr>
        <tr>
          <td class="propertyKey">text.wrap.defaultLineLength</td>
          <td class="propertyValue"><i>iLength</i></td>
        </tr>
        <tr>
          <td class="propertyKey">text.wrap.endOfSentencePattern</td>
          <td class="propertyValue"><i>sPattern</i></td>
        </tr>
        <tr>
          <td class="propertyKey">text.wrap.numSpacesBetweenSentences</td>
          <td class="propertyValue"><i>iNumSpaces</i></td>
        </tr>
      </table>

    </div>

    <!--=====================================================================================-->

    <!-- The choice of ciphers for the Fortuna PRNG -->

    <div class="section">
      <h2 id="sectionC">Appendix C:&nbsp; The choice of ciphers for the Fortuna PRNG</h2>
      <p class="tocLink">
        [ <a href="#toc">Table of contents</a> ]
      </p>

      <p class="wrap">
        For a cipher to be considered for the Qana implementation of the <a class="external"
        href="https://en.wikipedia.org/wiki/Fortuna_%28PRNG%29">Fortuna</a> <abbr
        title="Pseudo-random number generator">PRNG</abbr>, it had to be a 256-bit block cipher
        that could run in counter mode (or, like Salsa20, be functionally equivalent to such a
        cipher), with an open specification and unencumbered by patents or other restrictions on
        use.  In addition to satisfying the basic requirements, the two chosen ciphers, AES-256
        and Salsa20, are well-regarded, and all published attacks on them are currently
        infeasible.  (To date, the best key-recovery attack on AES-256 is about four times
        faster than brute force, which effectively reduces its security to that of a 254-bit
        cipher.)
      </p>
      <p class="wrap">
        The ciphers were also chosen for their algorithmic diversity: the Rijndael (AES) and
        Salsa20 algorithms belong to different classes, and the author of Qana (who is not a
        cryptographer) expects that a successful attack on one class of algorithm would not
        extend to the other class.
      </p>
      <p class="wrap">
        AES is the cipher that is commonly used for the Fortuna PRNG; Salsa20, on the other
        hand, is not used in its intended way in Qana.  According to its specification, Salsa20
        should have a key that may be fixed over multiple uses of the cipher, and a <a
        class="external" href="https://en.wikipedia.org/wiki/Cryptographic_nonce">nonce</a>
        (initialisation vector) that is unique for each use of the cipher with a given key.  In
        Qana, the Salsa20 cipher is used with a constant nonce, and a random key that &mdash;
        assuming a high-quality entropy source &mdash; is unique for each use of the cipher and
        is changed periodically during a single use of the cipher through feedback from the
        PRNG.  Salsa20 was used as the base cipher for the PRNG in the belief that the
        uniqueness requirement is satisfied just as well by a unique key as by a unique nonce.
        However, the author of Qana is not competent to pronounce on the security of the use of
        the Salsa20 cipher for a Fortuna PRNG, nor does he know of any cryptanalysis of such a
        use of Salsa20.
      </p>

    </div>

    <!--=====================================================================================-->

    <!-- Footer -->

    <div id="lastModified">
      <div>
        <div>
          Last modified: 2023-08-13
        </div>
        <div class="image">
          <a class="hideHover" href="http://validator.w3.org/check?uri=referer">
            <img alt="XHTML 1.1" src="images/valid-xhtml11-blue.png"/>
          </a>
        </div>
      </div>
    </div>

  </body>
</html>
